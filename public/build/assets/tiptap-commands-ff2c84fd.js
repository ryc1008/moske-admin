import{s as e,l as t,w as n}from"./prosemirror-commands-5439721d.js";import{l as r,w as o}from"./prosemirror-schema-list-cb4e861d.js";import{I as s}from"./prosemirror-inputrules-f48e44a0.js";import{P as c}from"./prosemirror-state-425d0e8b.js";import{S as a,F as i}from"./prosemirror-model-e99bf1dc.js";import{b as p,n as l,f as d}from"./tiptap-utils-dfe96f8c.js";function u(e,t,n){return new s(e,((e,r,o,s)=>{const c=n instanceof Function?n(r):n,{tr:a}=e,i=r.length-1;let p=s,l=o;if(r[i]){const n=o+r[0].indexOf(r[i-1]),c=n+r[i-1].length-1,d=n+r[i-1].lastIndexOf(r[i]),u=d+r[i].length,f=function(e,t,n){let r=[];return n.doc.nodesBetween(e,t,((e,t)=>{r=[...r,...e.marks.map((n=>({start:t,end:t+e.nodeSize,mark:n})))]})),r}(o,s,e).filter((e=>{const{excluded:n}=e.mark.type;return n.find((e=>e.name===t.name))})).filter((e=>e.end>n));if(f.length)return!1;u<c&&a.delete(u,c),d>n&&a.delete(n,d),l=n,p=l+r[i].length}return a.addMark(l,p,t.create(c)),a.removeStoredMark(t),a}))}function f(e,t,n){return new s(e,((e,r,o,s)=>{const c=n instanceof Function?n(r):n,{tr:a}=e;return r[0]&&a.replaceWith(o-1,s,t.create(c)),a}))}function m(e,t,n){const r=o=>{const s=[];return o.forEach((o=>{if(o.isText){const{text:r}=o;let c,a=0;do{if(c=e.exec(r),c){const e=c.index,r=e+c[0].length,i=n instanceof Function?n(c[0]):n;e>0&&s.push(o.cut(a,e)),s.push(o.cut(e,r).mark(t.create(i).addToSet(o.marks))),a=r}}while(c);a<r.length&&s.push(o.cut(a))}else s.push(o.copy(r(o.content)))})),i.fromArray(s)};return new c({props:{transformPasted:e=>new a(r(e.content),e.openStart,e.openEnd)}})}function h(e,t,n){const r=(o,s)=>{const c=[];return o.forEach((o=>{if(o.isText){const{text:r,marks:a}=o;let i,p=0;const l=!!a.filter((e=>"link"===e.type.name))[0];for(;!l&&null!==(i=e.exec(r));)if(s&&s.type.allowsMarkType(t)&&i[1]){const e=i.index,r=e+i[0].length,s=e+i[0].indexOf(i[1]),a=s+i[1].length,l=n instanceof Function?n(i):n;e>0&&c.push(o.cut(p,e)),c.push(o.cut(s,a).mark(t.create(l).addToSet(o.marks))),p=r}p<r.length&&c.push(o.cut(p))}else c.push(o.copy(r(o.content,o)))})),i.fromArray(c)};return new c({props:{transformPasted:e=>new a(r(e.content),e.openStart,e.openEnd)}})}function y(e){return(t,n)=>{const{tr:r,selection:o}=t;let{from:s,to:c}=o;const{$from:a,empty:i}=o;if(i){const t=p(a,e);s=t.from,c=t.to}return r.removeMark(s,c,e),n(r)}}function k(e){return function(t,n){const{$from:r,$to:o,node:s}=t.selection;if(s&&s.isBlock||r.depth<2||!r.sameParent(o))return!1;const c=r.node(-1);if(c.type!=e)return!1;if(0==r.parent.content.size){if(2==r.depth||r.node(-3).type!=e||r.index(-2)!=r.node(-2).childCount-1)return!1;if(n){let o=i.empty;const s=r.index(-1)>0;for(let e=r.depth-(s?1:2);e>=r.depth-3;e--)o=i.from(r.node(e).copy(o));o=o.append(i.from(e.createAndFill()));const c=t.tr.replace(r.before(s?null:-1),r.after(-3),new a(o,s?3:2,2));c.setSelection(t.selection.constructor.near(c.doc.resolve(r.pos+(s?3:2)))),n(c.scrollIntoView())}return!0}const p=o.pos==r.end()?c.contentMatchAt(r.indexAfter(-1)).defaultType:null,l=t.tr.delete(r.pos,o.pos);let d=p&&[{type:e},{type:p}];return d||(d=[{type:e},null]),!!function(e,t,n=1,r){const o=e.resolve(t),s=o.depth-n,c=r&&r[r.length-1]||o.parent;if(s<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!c.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let p=o.depth-1,l=n-2;p>s;p--,l--){const e=o.node(p),t=o.index(p);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount);const s=r&&r[l]||e;if(s!=e&&(n=n.replaceChild(0,s.type.create(s.attrs))),!e.canReplace(t+1,e.childCount))return!1}const a=o.indexAfter(s),i=r&&r[0];return o.node(s).canReplaceWith(a,a,i?i.type:o.node(s+1).type)}(l.doc,r.pos,2,d)&&(n&&n(l.split(r.pos,2,d).scrollIntoView()),!0)}}function x(t,n,r={}){return(o,s,c)=>l(o,t,r)?e(n)(o,s,c):e(t,r)(o,s,c)}function g(e,t){return e.type===t.nodes.bullet_list||e.type===t.nodes.ordered_list||e.type===t.nodes.todo_list}function w(e,t){return(n,s,c)=>{const{schema:a,selection:i}=n,{$from:p,$to:l}=i,u=p.blockRange(l);if(!u)return!1;const f=d((e=>g(e,a)))(i);if(u.depth>=1&&f&&u.depth-f.depth<=1){if(f.node.type===e)return r(t)(n,s,c);if(g(f.node,a)&&e.validContent(f.node.content)){const{tr:t}=n;return t.setNodeMarkup(f.pos,e),s&&s(t),!1}}return o(e)(n,s,c)}}function M(e,r={}){return(o,s,c)=>l(o,e,r)?t(o,s):n(e,r)(o,s,c)}function S(e,t){return(n,r)=>{const{tr:o,selection:s,doc:c}=n,{ranges:a,empty:i}=s;if(i){const{from:n,to:r}=p(s.$from,e);c.rangeHasMark(n,r,e)&&o.removeMark(n,r,e),o.addMark(n,r,e.create(t))}else a.forEach((n=>{const{$to:r,$from:s}=n;c.rangeHasMark(s.pos,r.pos,e)&&o.removeMark(s.pos,r.pos,e),o.addMark(s.pos,r.pos,e.create(t))}));return r(o)}}export{w as a,x as b,h as c,u as m,f as n,m as p,y as r,k as s,M as t,S as u};
