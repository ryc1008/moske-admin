import{r as e}from"./prosemirror-state-425d0e8b.js";import{r as t}from"./prosemirror-model-e99bf1dc.js";import{d as n}from"./prosemirror-tables-fdb699ea.js";var r={};Object.defineProperty(r,"__esModule",{value:!0});var o=e,i=t,a=n,c=function(e,t){return function(n){Array.isArray(e)||(e=[e]);for(var r=0,o=e.length;r<o;r++){var i=P(e[r])(n.selection);if(i){var a=m(i.pos,t)(n);if(a!==n)return a}}return n}},l=function(e){return function(t){if(p(t.selection)){var n=t.selection,r=n.$from,a=n.$to;if(e instanceof i.Fragment&&r.parent.canReplace(r.index(),r.indexAfter(),e)||r.parent.canReplaceWith(r.index(),r.indexAfter(),e.type))return h(t.replaceWith(r.pos,a.pos,e).setSelection(new o.NodeSelection(t.doc.resolve(r.pos))))}return t}},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(n){var r=o.Selection.findFrom(n.doc.resolve(e),t,!0);return r?n.setSelection(r):n}},f=function(e){return e.type&&e.type.spec.selectable},s=function(e,t,n){return function(e){return f(e)&&e.type.isLeaf}(e)?n.setSelection(new o.NodeSelection(n.doc.resolve(t))):u(t)(n)},d=function(e,t,n){return function(r){var o="number"==typeof t,i=r.selection.$from,a=o?r.doc.resolve(t):p(r.selection)?r.doc.resolve(i.pos+1):i,u=a.parent;if(p(r.selection)&&n&&r!==(r=l(e)(r)))return r;if(w(u)&&r!==(r=c(u.type,e)(r))){var d=f(e)?a.before(a.depth):a.pos;return s(e,d,r)}if(T(a,e)){r.insert(a.pos,e);var v=o?a.pos:f(e)?r.selection.$anchor.pos-1:r.selection.$anchor.pos;return h(s(e,v,r))}for(var m=a.depth;m>0;m--){var g=a.after(m),b=r.doc.resolve(g);if(T(b,e))return r.insert(g,e),h(s(e,g,r))}return r}},p=function(e){return e instanceof o.NodeSelection},v=function(e,t){return Array.isArray(e)&&e.indexOf(t.type)>-1||t.type===e},h=function(e){return Object.assign(Object.create(e),e).setTime(Date.now())},m=function(e,t){return function(n){var r=n.doc.nodeAt(e),o=n.doc.resolve(e);if(g(o,t)){var i=(n=n.replaceWith(e,e+r.nodeSize,t)).selection.$from.pos-1;return n=u(Math.max(i,0),-1)(n),n=u(n.selection.$from.start())(n),h(n)}return n}},g=function(e,t){var n=e.node(e.depth);return n&&n.type.validContent(t instanceof i.Fragment?t:i.Fragment.from(t))},b=function(e){return function(t){var n=t.doc.nodeAt(e);return h(t.delete(e,e+n.nodeSize))}},y=function(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;var t={};return Object.keys(e.nodes).forEach((function(n){var r=e.nodes[n];r.spec.tableRole&&(t[r.spec.tableRole]=r)})),e.cached.tableNodeTypes=t,t},T=function(e,t){var n=e.index();return t instanceof i.Fragment?e.parent.canReplace(n,n,t):t instanceof i.Node&&e.parent.canReplaceWith(n,n,t.type)},w=function(e){return!e||"paragraph"===e.type.name&&2===e.nodeSize},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?e.createChecked(null,t):e.createAndFill()},S=function(e){return function(t){for(var n=a.TableMap.get(t.$anchorCell.node(-1)),r=t.$anchorCell.start(-1),o=n.cellsInRect(e),i=n.cellsInRect(n.rectBetween(t.$anchorCell.pos-r,t.$headCell.pos-r)),c=0,l=o.length;c<l;c++)if(-1===i.indexOf(o[c]))return!1;return!0}},R=function(e){return e[0].map((function(t,n){return e.map((function(e){return e[n]}))}))},A=function(e){for(var t=a.TableMap.get(e),n=[],r=0;r<t.height;r++){for(var o=[],i={},c=0;c<t.width;c++){var l=t.map[r*t.width+c],u=e.nodeAt(l),f=t.findCell(l);i[l]||f.top!==r?o.push(null):(i[l]=!0,o.push(u))}n.push(o)}return n},N=function(e,t){for(var n=[],r=a.TableMap.get(e),o=0;o<r.height;o++){for(var i=e.child(o),c=[],l=0;l<r.width;l++)if(t[o][l]){var u=r.map[o*r.width+l],f=t[o][l],s=e.nodeAt(u).type.createChecked(Object.assign({},f.attrs),f.content,f.marks);c.push(s)}n.push(i.type.createChecked(i.attrs,c,i.marks))}return e.type.createChecked(e.attrs,n,e.marks)},$=function(e,t,n,r){var o=t[0]>n[0]?-1:1,i=e.splice(t[0],t.length),a=i.length%2==0?1:0,c=void 0;return c=-1===r&&1===o?n[0]-1:1===r&&-1===o?n[n.length-1]-a+1:-1===o?n[0]:n[n.length-1]-a,e.splice.apply(e,[c,0].concat(i)),e},M=function(e,t,n,r){var o="Target position is invalid, you can't move the "+r+" "+e+" to "+t+", the target can't be split. You could use tryToFit option.";if(1===(e>t?-1:1)){if(-1!==n.slice(0,n.length-1).indexOf(t))throw new Error(o)}else if(-1!==n.slice(1).indexOf(t))throw new Error(o);return!0},O=function(e){return function(t){var n=t.$from;return x(n,e)}},x=function(e,t){for(var n=e.depth;n>0;n--){var r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}},k=function(e,t){return function(n){var r=O(e)(n);if(r)return j(r.pos,t)}},I=function(e){return function(t){return!!O(e)(t)}},P=function(e){return function(t){return O((function(t){return v(e,t)}))(t)}},E=function(e){var t=e.$from.nodeBefore,n=o.Selection.findFrom(e.$from,-1);if(n&&t){var r=P(t.type)(n);return r?r.pos:n.$from.pos}},j=function(e,t){var n=t(e),r=n.node.childNodes[n.offset];return n.node.nodeType===Node.TEXT_NODE?n.node.parentNode:r&&r.nodeType!==Node.TEXT_NODE?r:n.node},F=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)throw new Error('Invalid "node" parameter');var n=[];return e.descendants((function(e,r){if(n.push({node:e,pos:r}),!t)return!1})),n},B=function(e,t,n){if(!e)throw new Error('Invalid "node" parameter');if(!t)throw new Error('Invalid "predicate" parameter');return F(e,n).filter((function(e){return t(e.node)}))},z=function(e,t,n){return B(e,(function(e){return e.type===t}),n)};var W=function(e){return O((function(e){return e.type.spec.tableRole&&"table"===e.type.spec.tableRole}))(e)},D=function(e){return e instanceof a.CellSelection},_=function(e){if(D(e)){var t=a.TableMap.get(e.$anchorCell.node(-1));return S({left:0,right:t.width,top:0,bottom:t.height})(e)}return!1},q=function(e){return function(t){var n=W(t);if(n){var r=a.TableMap.get(n.node);return(Array.isArray(e)?e:Array.from([e])).reduce((function(e,t){if(t>=0&&t<=r.width-1){var o=r.cellsInRect({left:t,right:t+1,top:0,bottom:r.height});return e.concat(o.map((function(e){var t=n.node.nodeAt(e),r=e+n.start;return{pos:r,start:r+1,node:t}})))}}),[])}}},X=function(e){return function(t){var n=W(t);if(n){var r=a.TableMap.get(n.node);return(Array.isArray(e)?e:Array.from([e])).reduce((function(e,t){if(t>=0&&t<=r.height-1){var o=r.cellsInRect({left:0,right:r.width,top:t,bottom:t+1});return e.concat(o.map((function(e){var t=n.node.nodeAt(e),r=e+n.start;return{pos:r,start:r+1,node:t}})))}}),[])}}},L=function(e){return function(t,n){return function(r){var o=W(r.selection),i="row"===e;if(o){var c=a.TableMap.get(o.node);if(t>=0&&t<(i?c.height:c.width)){var l=i?0:t,u=i?t:0,f=i?c.width:t+1,s=i?t+1:c.height;if(n){var d=V(r.selection.$from);if(!d)return r;var p=c.findCell(d.pos-o.start);i?(u=Math.min(u,p.top),s=Math.max(s,p.bottom)):(l=Math.min(l,p.left),f=Math.max(f,p.right))}var v=c.cellsInRect({left:l,top:u,right:i?f:l+1,bottom:i?u+1:s}),m=s-u==1?v:c.cellsInRect({left:i?l:f-1,top:i?s-1:u,right:f,bottom:s}),g=o.start+v[0],b=o.start+m[m.length-1],y=r.doc.resolve(g),T=r.doc.resolve(b);return h(r.setSelection(new a.CellSelection(T,y)))}}return r}}},Y=L("column"),G=L("row"),H=function(e){return function(t){var n=W(t.selection);if(n){var r=a.TableMap.get(n.node);if(e>=0&&e<=r.height){for(var o=n.node,i=y(o.type.schema),c=n.start,l=0;l<e+1;l++)c+=o.child(l).nodeSize;var u=o.child(e),f=[],s=0;if(u.forEach((function(e){1===e.attrs.rowspan&&(s+=e.attrs.colspan,f.push(i[e.type.spec.tableRole].createAndFill(e.attrs,e.marks)))})),s<r.width){for(var p=[],v=function(n){var r=ee(n,(function(t,r){var o=t.node.attrs.rowspan;return o>1&&n+o>e}))(t);p.push.apply(p,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r))},h=e;h>=0;h--)v(h);p.length&&p.forEach((function(e){t=U(e,{rowspan:e.node.attrs.rowspan+1})(t)}))}return d(i.row.create(u.attrs,f),c)(t)}}return t}},J=function(e){return function(t){var n=W(t.selection);if(n){var r=a.TableMap.get(n.node);if(0===e&&1===r.width)return Q(t);if(e>=0&&e<=r.width)return a.removeColumn(t,{map:r,tableStart:n.start,table:n.node},e),h(t)}return t}},K=function(e){return function(t){var n=W(t.selection);if(n){var r=a.TableMap.get(n.node);if(0===e&&1===r.height)return Q(t);if(e>=0&&e<=r.height)return a.removeRow(t,{map:r,tableStart:n.start,table:n.node},e),h(t)}return t}},Q=function(e){for(var t=e.selection.$from,n=t.depth;n>0;n--){if("table"===t.node(n).type.spec.tableRole)return h(e.delete(t.before(n),t.after(n)))}return e},U=function(e,t){return function(n){return e?(n.setNodeMarkup(e.pos,null,Object.assign({},e.node.attrs,t)),h(n)):n}},V=function(e){return x(e,(function(e){return e.type.spec.tableRole&&/cell/i.test(e.type.spec.tableRole)}))},Z=function(e){var t=V(e);if(t){var n=function(e){return x(e,(function(e){return e.type.spec.tableRole&&/table/i.test(e.type.spec.tableRole)}))}(e),r=a.TableMap.get(n.node),o=t.pos-n.start;return r.rectBetween(o,o)}},ee=function(e,t){return function(n){var r=[],o=X(e)(n.selection);if(o)for(var i=o.length-1;i>=0;i--)t(o[i],n)&&r.push(o[i]);return r}},te=function(e){return function(t){for(var n=e,r=e,o=function(e){var o=q(e)(t.selection);o&&o.forEach((function(t){var o=t.node.attrs.colspan+e-1;o>=n&&(n=e),o>r&&(r=o)}))},i=e;i>=0;i--)o(i);var a=function(e){var n=q(e)(t.selection);n&&n.forEach((function(t){var n=t.node.attrs.colspan+e-1;t.node.attrs.colspan>1&&n>r&&(r=n)}))};for(i=e;i<=r;i++)a(i);var c=[];for(i=n;i<=r;i++){var l=q(i)(t.selection);l&&l.length&&c.push(i)}n=c[0],r=c[c.length-1];for(var u=q(n)(t.selection),f=X(0)(t.selection),s=t.doc.resolve(u[u.length-1].pos),d=void 0,p=r;p>=n;p--){var v=q(p)(t.selection);if(v&&v.length){for(var h=f.length-1;h>=0;h--)if(f[h].pos===v[0].pos){d=v[0];break}if(d)break}}return{$anchor:s,$head:t.doc.resolve(d.pos),indexes:c}}},ne=function(e){return function(t){for(var n=e,r=e,o=function(e){X(e)(t.selection).forEach((function(t){var o=t.node.attrs.rowspan+e-1;o>=n&&(n=e),o>r&&(r=o)}))},i=e;i>=0;i--)o(i);var a=function(e){X(e)(t.selection).forEach((function(t){var n=t.node.attrs.rowspan+e-1;t.node.attrs.rowspan>1&&n>r&&(r=n)}))};for(i=e;i<=r;i++)a(i);var c=[];for(i=n;i<=r;i++){var l=X(i)(t.selection);l&&l.length&&c.push(i)}n=c[0],r=c[c.length-1];for(var u=X(n)(t.selection),f=q(0)(t.selection),s=t.doc.resolve(u[u.length-1].pos),d=void 0,p=r;p>=n;p--){var v=X(p)(t.selection);if(v&&v.length){for(var h=f.length-1;h>=0;h--)if(f[h].pos===v[0].pos){d=v[0];break}if(d)break}}return{$anchor:s,$head:t.doc.resolve(d.pos),indexes:c}}};r.isNodeSelection=p,r.canInsert=T,r.convertTableNodeToArrayOfRows=A,r.convertArrayOfRowsToTableNode=N,r.findParentNode=O,r.findParentNodeClosestToPos=x,r.findParentDomRef=k,r.hasParentNode=I;var re=r.findParentNodeOfType=P;r.findParentNodeOfTypeClosestToPos=function(e,t){return x(e,(function(e){return v(t,e)}))},r.hasParentNodeOfType=function(e){return function(t){return I((function(t){return v(e,t)}))(t)}},r.findParentDomRefOfType=function(e,t){return function(n){return k((function(t){return v(e,t)}),t)(n)}},r.findSelectedNodeOfType=function(e){return function(t){if(p(t)){var n=t.node,r=t.$from;if(v(e,n))return{node:n,pos:r.pos,depth:r.depth}}}},r.findPositionOfNodeBefore=E,r.findDomRefAtPos=j,r.flatten=F,r.findChildren=B,r.findTextNodes=function(e,t){return B(e,(function(e){return e.isText}),t)},r.findInlineNodes=function(e,t){return B(e,(function(e){return e.isInline}),t)},r.findBlockNodes=function(e,t){return B(e,(function(e){return e.isBlock}),t)},r.findChildrenByAttr=function(e,t,n){return B(e,(function(e){return!!t(e.attrs)}),n)},r.findChildrenByType=z,r.findChildrenByMark=function(e,t,n){return B(e,(function(e){return t.isInSet(e.marks)}),n)},r.contains=function(e,t){return!!z(e,t).length},r.findTable=W,r.isCellSelection=D,r.getSelectionRect=function(e){if(D(e)){var t=e.$anchorCell.start(-1);return a.TableMap.get(e.$anchorCell.node(-1)).rectBetween(e.$anchorCell.pos-t,e.$headCell.pos-t)}},r.isColumnSelected=function(e){return function(t){if(D(t)){var n=a.TableMap.get(t.$anchorCell.node(-1));return S({left:e,right:e+1,top:0,bottom:n.height})(t)}return!1}},r.isRowSelected=function(e){return function(t){if(D(t)){var n=a.TableMap.get(t.$anchorCell.node(-1));return S({left:0,right:n.width,top:e,bottom:e+1})(t)}return!1}},r.isTableSelected=_,r.getCellsInColumn=q,r.getCellsInRow=X,r.getCellsInTable=function(e){var t=W(e);if(t){var n=a.TableMap.get(t.node);return n.cellsInRect({left:0,right:n.width,top:0,bottom:n.height}).map((function(e){var n=t.node.nodeAt(e),r=e+t.start;return{pos:r,start:r+1,node:n}}))}},r.selectColumn=Y,r.selectRow=G,r.selectTable=function(e){var t=W(e.selection);if(t){var n=a.TableMap.get(t.node).map;if(n&&n.length){var r=t.start+n[0],o=t.start+n[n.length-1],i=e.doc.resolve(r),c=e.doc.resolve(o);return h(e.setSelection(new a.CellSelection(c,i)))}}return e},r.emptyCell=function(e,t){return function(n){if(e){var r=y(t).cell.createAndFill().content;if(!e.node.content.eq(r))return n.replaceWith(e.pos+1,e.pos+e.node.nodeSize,r),h(n)}return n}},r.addColumnAt=function(e){return function(t){var n=W(t.selection);if(n){var r=a.TableMap.get(n.node);if(e>=0&&e<=r.width)return h(a.addColumn(t,{map:r,tableStart:n.start,table:n.node},e))}return t}},r.moveRow=function(e,t,n){return function(r){var o=Object.assign({tryToFit:!1,direction:0},n),i=W(r.selection);if(!i)return r;var a=ne(e)(r).indexes,c=ne(t)(r).indexes;if(a.indexOf(t)>-1)return r;!o.tryToFit&&c.length>1&&M(e,t,c,"row");var l=function(e,t,n,r){var o=A(e.node);return o=$(o,t,n,r),N(e.node,o)}(i,a,c,o.direction);return h(r).replaceWith(i.pos,i.pos+i.node.nodeSize,l)}},r.moveColumn=function(e,t,n){return function(r){var o=Object.assign({tryToFit:!1,direction:0},n),i=W(r.selection);if(!i)return r;var a=te(e)(r).indexes,c=te(t)(r).indexes;if(a.indexOf(t)>-1)return r;!o.tryToFit&&c.length>1&&M(e,t,c,"column");var l=function(e,t,n,r){var o=R(A(e.node));return o=$(o,t,n,r),o=R(o),N(e.node,o)}(i,a,c,o.direction);return h(r).replaceWith(i.pos,i.pos+i.node.nodeSize,l)}},r.addRowAt=function(e,t){return function(n){var r=W(n.selection);if(r){var o=a.TableMap.get(r.node),i=e-1;if(t&&i>=0)return h(H(i)(n));if(e>=0&&e<=o.height)return h(a.addRow(n,{map:o,tableStart:r.start,table:r.node},e))}return n}},r.cloneRowAt=H,r.removeColumnAt=J,r.removeRowAt=K,r.removeTable=Q,r.removeSelectedColumns=function(e){var t=e.selection;if(_(t))return Q(e);if(D(t)){var n=W(t);if(n){var r=a.TableMap.get(n.node),o=r.rectBetween(t.$anchorCell.pos-n.start,t.$headCell.pos-n.start);if(0==o.left&&o.right==r.width)return!1;for(var i=Object.assign({},o,{map:r,table:n.node,tableStart:n.start}),c=i.right-1;a.removeColumn(e,i,c),c!==i.left;c--)i.table=i.tableStart?e.doc.nodeAt(i.tableStart-1):e.doc,i.map=a.TableMap.get(i.table);return h(e)}}return e},r.removeSelectedRows=function(e){var t=e.selection;if(_(t))return Q(e);if(D(t)){var n=W(t);if(n){var r=a.TableMap.get(n.node),o=r.rectBetween(t.$anchorCell.pos-n.start,t.$headCell.pos-n.start);if(0==o.top&&o.bottom==r.height)return!1;for(var i=Object.assign({},o,{map:r,table:n.node,tableStart:n.start}),c=i.bottom-1;a.removeRow(e,i,c),c!==i.top;c--)i.table=i.tableStart?e.doc.nodeAt(i.tableStart-1):e.doc,i.map=a.TableMap.get(i.table);return h(e)}}return e},r.removeColumnClosestToPos=function(e){return function(t){var n=Z(e);return n?J(n.left)(u(e.pos)(t)):t}},r.removeRowClosestToPos=function(e){return function(t){var n=Z(e);return n?K(n.top)(u(e.pos)(t)):t}},r.forEachCellInColumn=function(e,t,n){return function(r){var i=q(e)(r.selection);if(i){for(var a=i.length-1;a>=0;a--)r=t(i[a],r);if(n){var c=r.doc.resolve(r.mapping.map(i[i.length-1].pos));r.setSelection(o.Selection.near(c))}return h(r)}return r}},r.forEachCellInRow=function(e,t,n){return function(r){var i=X(e)(r.selection);if(i){for(var a=i.length-1;a>=0;a--)r=t(i[a],r);if(n){var c=r.doc.resolve(r.mapping.map(i[i.length-1].pos));r.setSelection(o.Selection.near(c))}}return r}},r.setCellAttrs=U,r.createTable=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=y(e),a=i.cell,c=i.header_cell,l=i.row,u=i.table,f=[],s=[],d=0;d<n;d++)f.push(C(a,o)),r&&s.push(C(c,o));for(var p=[],v=0;v<t;v++)p.push(l.createChecked(null,r&&0===v?s:f));return u.createChecked(null,p)},r.findCellClosestToPos=V,r.findCellRectClosestToPos=Z,r.getSelectionRangeInColumn=te,r.getSelectionRangeInRow=ne,r.removeParentNodeOfType=function(e){return function(t){var n=P(e)(t.selection);return n?b(n.pos)(t):t}},r.replaceParentNodeOfType=c,r.removeSelectedNode=function(e){if(p(e.selection)){var t=e.selection.$from.pos,n=e.selection.$to.pos;return h(e.delete(t,n))}return e},r.replaceSelectedNode=l,r.setTextSelection=u,r.safeInsert=d,r.setParentNodeMarkup=function(e,t,n,r){return function(o){var i=P(e)(o.selection);return i?h(o.setNodeMarkup(i.pos,t,Object.assign({},i.node.attrs,n),r)):o}},r.selectParentNodeOfType=function(e){return function(t){if(!p(t.selection)){var n=P(e)(t.selection);if(n)return h(t.setSelection(o.NodeSelection.create(t.doc,n.pos)))}return t}},r.removeNodeBefore=function(e){var t=E(e.selection);return"number"==typeof t?b(t)(e):e};export{re as f};
