import{m as t}from"./vuex-fb1740e5.js";import{ba as s,bb as e,bc as r,bd as i}from"./app-64dc16a0.js";import{n as a}from"./vue-verify-code-21b6e9ae.js";import"./w-e6fba1f3.js";import"./axios-5ae1da96.js";import"./vue-9f7ddc78.js";import"./async-validator-68c927eb.js";import"./babel-runtime-b0e6bb14.js";import"./crypto-js-e93d4fbc.js";import"./element-tiptap-f39d3908.js";import"./tiptap-cd99e86f.js";import"./prosemirror-state-aff6b6a5.js";import"./prosemirror-model-e99bf1dc.js";import"./orderedmap-1ac72264.js";import"./prosemirror-transform-0ba15ba3.js";import"./prosemirror-view-e30b2d7a.js";import"./prosemirror-dropcursor-41f27ba8.js";import"./prosemirror-gapcursor-8cdc000d.js";import"./prosemirror-keymap-e0a1e6d1.js";import"./w3c-keyname-5afe5a41.js";import"./prosemirror-commands-994280f1.js";import"./prosemirror-inputrules-51b7290b.js";import"./tiptap-utils-1e7277fa.js";import"./tiptap-extensions-b74a4f9a.js";import"./tiptap-commands-9e395e16.js";import"./prosemirror-schema-list-a2d0a333.js";import"./highlight.js-45c9f23d.js";import"./fault-4bc10d66.js";import"./format-ca30c10a.js";import"./prosemirror-history-094ab62a.js";import"./rope-sequence-72d4f3ff.js";import"./prosemirror-utils-15148092.js";import"./prosemirror-tables-78b83e4c.js";import"./element-ui-85fcec33.js";import"./resize-observer-polyfill-26170312.js";import"./throttle-debounce-f2d3495b.js";import"./babel-helper-vue-jsx-merge-props-ae7f6986.js";import"./normalize-wheel-2c441d7d.js";import"./deepmerge-1c41bee1.js";import"./image-conversion-5dc521cd.js";import"./nprogress-e46a079b.js";import"./vue-cookie-f9b70f6c.js";import"./tiny-cookie-01c919d1.js";import"./moment-0b360bb8.js";/* empty css                     */import"./xgplayer-ddb6d22b.js";import"./eventemitter3-91a3dd57.js";import"./delegate-333e72eb.js";import"./downloadjs-bf7647fe.js";import"./xgplayer-hls-e482b1c5.js";import"./xgplayer-streaming-shared-a05e1a43.js";import"./xgplayer-transmuxer-2825904a.js";import"./xgplayer-music-47c62e3d.js";import"./vue-router-29840f2f.js";import"./vue-axios-5ff5ffea.js";import"./qs-7cd75b61.js";import"./side-channel-c3af32fe.js";import"./get-intrinsic-bac01933.js";import"./has-symbols-456daba2.js";import"./has-proto-4a87f140.js";import"./function-bind-72d06d3b.js";import"./has-885c3436.js";import"./call-bind-fae29077.js";import"./object-inspect-d5fba9a3.js";const o=a({computed:{...t({tableHeight:t=>t.tableHeight})},data:function(){return{loading:!1,datas:null,auths:null,quick:!1,params:{page:1,kwd:""},button:{loading:!1,disable:!1,text:"提 交"},dialog:{title:"",show:!1},form:null,selection:[],rules:{name:[{required:!0,message:"请填写角色名称",trigger:"blur"}]},nameArr:[],markArr:[],accessArr:[],sortArr:[]}},activated(){this.tree(),this.list()},methods:{tree(){s().then((t=>{0===t.status&&(this.auths=t.data)}))},async list(){await this.$func.verify("authen.list"),this.loading=!0,e(this.params).then((t=>{t.status?this.$func.error(t.message):this.datas=t.data,this.loading=!1})).catch((t=>{this.loading=!1}))},async create(){await this.$func.verify("authen.update"),this.form={id:0,name:"",mark:"",parent_id:1e4,access:"",sort:""},this.quick=!1,this.nameArr=[],this.markArr=[],this.accessArr=[],this.sortArr=[],this.select(this.form.parent_id),this.dialog.title="新增权限",this.dialog.show=!0,this.$nextTick((()=>{this.$refs.form.clearValidate()}))},async edit(t){await this.$func.verify("authen.update"),this.form={id:t.id,parent_id:t.parent_id,mark:t.mark,name:t.name,access:t.access,sort:0==t.sort?"":t.sort},this.quick=!1,this.dialog.title="编辑权限",this.dialog.show=!0,this.$nextTick((()=>{this.$refs.form.clearValidate()}))},update(){this.$refs.form.validate((t=>{t&&(this.button.disabled=!0,this.button.loading=!0,this.button.text="提交中...",r(this.form).then((t=>{t.status?this.$func.error(t.message):this.$func.success(t.message).then((()=>{this.dialog.show=!1,this.list(),this.tree()})),this.button.disabled=!1,this.button.loading=!1,this.button.text="提 交"})).catch((t=>{this.button.disabled=!1,this.button.loading=!1,this.button.text="提 交"})))}))},multiple(t){this.selection=[],t.length&&t.forEach((t=>{this.selection.push(t.id)}))},del(){if(!this.selection.length)return this.$func.error("请选择你要操作的数据"),!1;this.destroy(this.selection)},async destroy(t){await this.$func.verify("authen.destroy"),this.$confirm("您确定要删除选中的该条信息吗？","提示",{type:"warning",confirmButtonText:"确 定",cancelButtonText:"取 消"}).then((()=>{i({id:t}).then((t=>{t.status?this.$func.error(t.message):this.list()}))})).catch((()=>{}))},access(t,s){this.recursion(this.form.parent_id,this.datas,(e=>{e.mark&&(this.nameArr.push(s),this.markArr.push(e.mark+"."+t),this.accessArr.push(e.mark+"."+t),this.sortArr.push(this.nameArr.length),this.form.name=this.nameArr.join("|"),this.form.mark=this.markArr.join("|"),this.form.access=this.accessArr.join("|"),this.form.sort=this.sortArr.join("|"))}))},search(){this.searchNode(this.datas,(t=>{this.datas=t}))},searchNode(t,s){this.params.kwd||this.list(),t.length&&t.filter((t=>{-1!==t.name.indexOf(this.params.kwd)?s([t]):t.children&&!t.mark&&this.searchNode(t.children,s)}))},page(t){this.params.page=t,this.list()},select(t){1e4==t?(this.form.sort=this.datas.length+1,this.quick=!1):this.recursion(this.form.parent_id,this.datas,(t=>{this.form.sort=t.number,this.quick=!!t.mark}))},recursion(t,s,e){s.length&&s.filter((s=>{s.id==t?e({number:s.children?s.children.length+1:1,mark:s.mark}):s.children&&this.recursion(t,s.children,e)}))}}},(function(){var t=this,s=t._self._c;return s("div",{staticClass:"board-content"},[s("div",{staticClass:"board-header"},[s("div",{staticClass:"board-search"},[s("div",{staticClass:"search-item"},[s("el-input",{attrs:{placeholder:"请输入名称",size:"small",clearable:""},model:{value:t.params.kwd,callback:function(s){t.$set(t.params,"kwd",s)},expression:"params.kwd"}})],1),s("div",{staticClass:"search-item"},[s("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:function(s){return t.search()}}},[t._v("搜索")])],1)]),s("div",{staticClass:"board-handle"},[s("el-button",{attrs:{type:"warning",icon:"fa fa-refresh",size:"small"},on:{click:function(s){return t.list()}}},[t._v(" 刷新")]),s("el-button",{attrs:{type:"primary",icon:"fa fa-plus",size:"small"},on:{click:function(s){return t.create()}}},[t._v(" 新增")])],1)]),s("div",{staticClass:"board-main"},[t.datas?s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"努力加载中...","element-loading-spinner":"el-icon-loading",stripe:"","tooltip-effect":"dark",height:t.tableHeight,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},data:t.datas,border:""}},[s("el-table-column",{attrs:{prop:"name",label:"名称",width:"140"}}),s("el-table-column",{attrs:{prop:"access",label:"节点",width:"200"}}),s("el-table-column",{attrs:{prop:"mark",label:"标识",width:"200"}}),s("el-table-column",{attrs:{prop:"sort",label:"排序",width:"60",align:"center"}}),s("el-table-column",{attrs:{prop:"created_at",label:"创建时间",width:"160"},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v(" "+t._s(t.$func.formatDateTime(s.row.created_at))+" ")]}}],null,!1,1965584032)}),s("el-table-column",{attrs:{label:"操作","min-width":"270"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{type:"primary",icon:"fa fa-edit",size:"mini",plain:""},on:{click:function(s){return t.edit(e.row)}}},[t._v(" 编辑 ")]),e.row.id>1?s("el-button",{attrs:{type:"info",icon:"fa fa-trash",size:"mini",plain:""},on:{click:function(s){return t.destroy(e.row.id)}}},[t._v(" 删除 ")]):t._e()]}}],null,!1,1537130229)})],1):t._e()],1),s("el-dialog",{staticClass:"board-dialog",attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,title:t.dialog.title,visible:t.dialog.show,center:""},on:{"update:visible":function(s){return t.$set(t.dialog,"show",s)}}},[t.form?s("el-form",{ref:"form",staticClass:"board-form",attrs:{model:t.form,rules:t.rules,"label-width":"120px"}},[s("div",{staticClass:"item-title"},[t._v("基本信息"),s("div",{staticClass:"title-note"},[s("span",[t._v("* ")]),t._v("为必填项")])]),s("div",{staticClass:"form-item"},[s("el-form-item",{attrs:{label:"上 级：",prop:"parent_id"}},[s("el-select",{attrs:{size:"medium"},on:{change:t.select},model:{value:t.form.parent_id,callback:function(s){t.$set(t.form,"parent_id",s)},expression:"form.parent_id"}},t._l(t.auths,(function(e,r){return s("el-option",{key:r,attrs:{label:t.$func.strToBlank(e.title_show),value:e.id},domProps:{innerHTML:t._s(e.title_show)}})})),1)],1),s("el-form-item",{attrs:{label:"名 称：",prop:"name"}},[s("el-input",{attrs:{placeholder:"请填写权限名称, 多个用 | 隔开","prefix-icon":"fa fa-bars",size:"medium",clearable:""},model:{value:t.form.name,callback:function(s){t.$set(t.form,"name",s)},expression:"form.name"}})],1),t.quick?s("el-form-item",[s("div",{staticClass:"tag-box"},[s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("list","列表")}}},[t._v("列表")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("update","更新")}}},[t._v("更新【新增、编辑】")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("info","详情")}}},[t._v("详情")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("copy","复制")}}},[t._v("复制")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("active","启用")}}},[t._v("启用")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("lock","锁定")}}},[t._v("锁定")]),s("el-tag",{staticClass:"h-tag",on:{click:function(s){return t.access("destroy","删除")}}},[t._v("删除")])],1)]):t._e(),s("el-form-item",{attrs:{label:"标 识：",prop:"mark"}},[s("el-input",{attrs:{placeholder:"请填写权限标识, 多个用 | 隔开","prefix-icon":"fa fa-fire",size:"medium",clearable:""},model:{value:t.form.mark,callback:function(s){t.$set(t.form,"mark",s)},expression:"form.mark"}})],1),s("el-form-item",{attrs:{label:"节 点：",prop:"access"}},[s("el-input",{attrs:{placeholder:"请填写权限节点, 多个用 | 隔开","prefix-icon":"fa fa-code-fork",size:"medium",clearable:""},model:{value:t.form.access,callback:function(s){t.$set(t.form,"access",s)},expression:"form.access"}})],1),s("el-form-item",{attrs:{label:"排 序：",prop:"sort"}},[s("el-input",{attrs:{placeholder:"请填写排列顺序，同级数字越小，排名越靠前, 多个用 | 隔开","prefix-icon":"fa fa-sort-numeric-asc",size:"medium",clearable:""},model:{value:t.form.sort,callback:function(s){t.$set(t.form,"sort",s)},expression:"form.sort"}})],1)],1)]):t._e(),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",loading:t.button.loading,disabled:t.button.disable},on:{click:t.update}},[t._v(t._s(t.button.text))]),s("el-button",{staticClass:"close-btn",on:{click:function(s){t.dialog.show=!1}}},[t._v("关 闭")])],1)],1)],1)}),[],!1,null,"9342cffb",null,null).exports;export{o as default};
