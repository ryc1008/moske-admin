import{l as e,f as t,r as n,c as o,R as r,a as l}from"./prosemirror-transform-0ba15ba3.js";import{S as i,F as s}from"./prosemirror-model-e99bf1dc.js";import{S as c,A as a,N as p,T as f}from"./prosemirror-state-aff6b6a5.js";const d=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function u(e,t,n=!1){for(let o=e;o;o="start"==t?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(n&&1!=o.childCount)return!1}return!1}function m(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function h(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const g=(t,n)=>{let{$from:o,$to:r}=t.selection,l=o.blockRange(r),i=l&&e(l);return null!=i&&(n&&n(t.tr.lift(l,i).scrollIntoView()),!0)};function k(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const w=(e,t)=>{let{$head:n,$anchor:o}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;let r=n.node(-1),l=n.indexAfter(-1),i=k(r.contentMatchAt(l));if(!i||!r.canReplaceWith(l,l,i))return!1;if(t){let o=n.after(),r=e.tr.replaceWith(o,o,i.createAndFill());r.setSelection(c.near(r.doc.resolve(o),1)),t(r.scrollIntoView())}return!0};const y=(e,t)=>{let{$from:n,$to:r}=e.selection;if(e.selection instanceof p&&e.selection.node.isBlock)return!(!n.parentOffset||!o(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.parent.isBlock)return!1;if(t){let l=r.parentOffset==r.parent.content.size,i=e.tr;(e.selection instanceof f||e.selection instanceof a)&&i.deleteSelection();let s=0==n.depth?null:k(n.node(-1).contentMatchAt(n.indexAfter(-1))),c=b&&b(r.parent,l),p=c?[c]:l&&s?[{type:s}]:void 0,d=o(i.doc,i.mapping.map(n.pos),1,p);if(p||d||!o(i.doc,i.mapping.map(n.pos),1,s?[{type:s}]:void 0)||(s&&(p=[{type:s}]),d=!0),d&&(i.split(i.mapping.map(n.pos),1,p),!l&&!n.parentOffset&&n.parent.type!=s)){let e=i.mapping.map(n.before()),t=i.doc.resolve(e);s&&n.node(-1).canReplaceWith(t.index(),t.index()+1,s)&&i.setNodeMarkup(i.mapping.map(n.before()),s)}t(i.scrollIntoView())}return!0};var b;function x(t,n,o){let a,p,f=n.nodeBefore,d=n.nodeAfter;if(f.type.spec.isolating||d.type.spec.isolating)return!1;if(function(e,t,n){let o=t.nodeBefore,r=t.nodeAfter,i=t.index();return!(!(o&&r&&o.type.compatibleContent(r.type))||(!o.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-o.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!r.isTextblock&&!l(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,o.type,o.contentMatchAt(o.childCount)).join(t.pos).scrollIntoView()),0)))}(t,n,o))return!0;let m=n.parent.canReplace(n.index(),n.index()+1);if(m&&(a=(p=f.contentMatchAt(f.childCount)).findWrapping(d.type))&&p.matchType(a[0]||d.type).validEnd){if(o){let e=n.pos+d.nodeSize,c=s.empty;for(let t=a.length-1;t>=0;t--)c=s.from(a[t].create(null,c));c=s.from(f.copy(c));let p=t.tr.step(new r(n.pos-1,e,n.pos,e,new i(c,1,0),a.length,!0)),u=e+2*a.length;l(p.doc,u)&&p.join(u),o(p.scrollIntoView())}return!0}let h=c.findFrom(n,1),g=h&&h.$from.blockRange(h.$to),k=g&&e(g);if(null!=k&&k>=n.depth)return o&&o(t.tr.lift(g,k).scrollIntoView()),!0;if(m&&u(d,"start",!0)&&u(f,"end")){let e=f,l=[];for(;l.push(e),!e.isTextblock;)e=e.lastChild;let c=d,a=1;for(;!c.isTextblock;c=c.firstChild)a++;if(e.canReplace(e.childCount,e.childCount,c.content)){if(o){let e=s.empty;for(let t=l.length-1;t>=0;t--)e=s.from(l[t].copy(e));o(t.tr.step(new r(n.pos-l.length,n.pos+d.nodeSize,n.pos+a,n.pos+d.nodeSize-a,new i(e,l.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function $(e){return function(t,n){let o=t.selection,r=e<0?o.$from:o.$to,l=r.depth;for(;r.node(l).isInline;){if(!l)return!1;l--}return!!r.node(l).isTextblock&&(n&&n(t.tr.setSelection(f.create(t.doc,e<0?r.start(l):r.end(l)))),!0)}}const S=$(-1),I=$(1);function M(e,n=null){return function(o,r){let{$from:l,$to:i}=o.selection,s=l.blockRange(i),c=s&&t(s,e,n);return!!c&&(r&&r(o.tr.wrap(s,c).scrollIntoView()),!0)}}function V(e,t=null){return function(n,o){let r=!1;for(let l=0;l<n.selection.ranges.length&&!r;l++){let{$from:{pos:o},$to:{pos:i}}=n.selection.ranges[l];n.doc.nodesBetween(o,i,((o,l)=>{if(r)return!1;if(o.isTextblock&&!o.hasMarkup(e,t))if(o.type==e)r=!0;else{let t=n.doc.resolve(l),o=t.index();r=t.parent.canReplaceWith(o,o+1,e)}}))}if(!r)return!1;if(o){let r=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:i}}=n.selection.ranges[o];r.setBlockType(l,i,e,t)}o(r.scrollIntoView())}return!0}}function A(e,t=null){return function(n,o){let{empty:r,$cursor:l,ranges:i}=n.selection;if(r&&!l||!function(e,t,n){for(let o=0;o<t.length;o++){let{$from:r,$to:l}=t[o],i=0==r.depth&&e.inlineContent&&e.type.allowsMarkType(n);if(e.nodesBetween(r.pos,l.pos,(e=>{if(i)return!1;i=e.inlineContent&&e.type.allowsMarkType(n)})),i)return!0}return!1}(n.doc,i,e))return!1;if(o)if(l)e.isInSet(n.storedMarks||l.marks())?o(n.tr.removeStoredMark(e)):o(n.tr.addStoredMark(e.create(t)));else{let r=!1,l=n.tr;for(let t=0;!r&&t<i.length;t++){let{$from:o,$to:l}=i[t];r=n.doc.rangeHasMark(o.pos,l.pos,e)}for(let n=0;n<i.length;n++){let{$from:o,$to:s}=i[n];if(r)l.removeMark(o.pos,s.pos,e);else{let n=o.pos,r=s.pos,i=o.nodeAfter,c=s.nodeBefore,a=i&&i.isText?/^\s*/.exec(i.text)[0].length:0,p=c&&c.isText?/\s*$/.exec(c.text)[0].length:0;n+a<r&&(n+=a,r-=p),l.addMark(n,r,e.create(t))}}o(l.scrollIntoView())}return!0}}function C(...e){return function(t,n,o){for(let r=0;r<e.length;r++)if(e[r](t,n,o))return!0;return!1}}let T=C(d,((t,o,r)=>{let l=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}(t,r);if(!l)return!1;let s=m(l);if(!s){let n=l.blockRange(),r=n&&e(n);return null!=r&&(o&&o(t.tr.lift(n,r).scrollIntoView()),!0)}let a=s.nodeBefore;if(!a.type.spec.isolating&&x(t,s,o))return!0;if(0==l.parent.content.size&&(u(a,"end")||p.isSelectable(a))){let e=n(t.doc,l.before(),l.after(),i.empty);if(e&&e.slice.size<e.to-e.from){if(o){let n=t.tr.step(e);n.setSelection(u(a,"end")?c.findFrom(n.doc.resolve(n.mapping.map(s.pos,-1)),-1):p.create(n.doc,s.pos-a.nodeSize)),o(n.scrollIntoView())}return!0}}return!(!a.isAtom||s.depth!=l.depth-1)&&(o&&o(t.tr.delete(s.pos-a.nodeSize,s.pos).scrollIntoView()),!0)}),((e,t,n)=>{let{$head:o,empty:r}=e.selection,l=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):o.parentOffset>0)return!1;l=m(o)}let i=l&&l.nodeBefore;return!(!i||!p.isSelectable(i))&&(t&&t(e.tr.setSelection(p.create(e.doc,l.pos-i.nodeSize)).scrollIntoView()),!0)})),z=C(d,((e,t,o)=>{let r=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}(e,o);if(!r)return!1;let l=h(r);if(!l)return!1;let s=l.nodeAfter;if(x(e,l,t))return!0;if(0==r.parent.content.size&&(u(s,"start")||p.isSelectable(s))){let o=n(e.doc,r.before(),r.after(),i.empty);if(o&&o.slice.size<o.to-o.from){if(t){let n=e.tr.step(o);n.setSelection(u(s,"start")?c.findFrom(n.doc.resolve(n.mapping.map(l.pos)),1):p.create(n.doc,n.mapping.map(l.pos))),t(n.scrollIntoView())}return!0}}return!(!s.isAtom||l.depth!=r.depth-1)&&(t&&t(e.tr.delete(l.pos,l.pos+s.nodeSize).scrollIntoView()),!0)}),((e,t,n)=>{let{$head:o,empty:r}=e.selection,l=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)return!1;l=h(o)}let i=l&&l.nodeAfter;return!(!i||!p.isSelectable(i))&&(t&&t(e.tr.setSelection(p.create(e.doc,l.pos)).scrollIntoView()),!0)}));const B={Enter:C(((e,t)=>{let{$head:n,$anchor:o}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(o))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)}),((e,t)=>{let n=e.selection,{$from:o,$to:r}=n;if(n instanceof a||o.parent.inlineContent||r.parent.inlineContent)return!1;let l=k(r.parent.contentMatchAt(r.indexAfter()));if(!l||!l.isTextblock)return!1;if(t){let n=(!o.parentOffset&&r.index()<r.parent.childCount?o:r).pos,i=e.tr.insert(n,l.createAndFill());i.setSelection(f.create(i.doc,n+1)),t(i.scrollIntoView())}return!0}),((t,n)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let e=r.before();if(o(t.doc,e))return n&&n(t.tr.split(e).scrollIntoView()),!0}let l=r.blockRange(),i=l&&e(l);return null!=i&&(n&&n(t.tr.lift(l,i).scrollIntoView()),!0)}),y),"Mod-Enter":w,Backspace:T,"Mod-Backspace":T,"Shift-Backspace":T,Delete:z,"Mod-Delete":z,"Mod-a":(e,t)=>(t&&t(e.tr.setSelection(new a(e.doc))),!0)},v={"Ctrl-h":B.Backspace,"Alt-Backspace":B["Mod-Backspace"],"Ctrl-d":B.Delete,"Ctrl-Alt-Backspace":B["Mod-Delete"],"Alt-Delete":B["Mod-Delete"],"Alt-d":B["Mod-Delete"],"Ctrl-a":S,"Ctrl-e":I};for(let O in B)v[O]=B[O];const R=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&"darwin"==os.platform())?v:B;export{R as b,C as c,w as e,g as l,V as s,A as t,M as w};
