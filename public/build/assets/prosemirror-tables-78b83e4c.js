import{r as e}from"./prosemirror-state-aff6b6a5.js";import{r as t}from"./prosemirror-view-e30b2d7a.js";import{r}from"./prosemirror-model-e99bf1dc.js";import{e as n}from"./prosemirror-transform-0ba15ba3.js";import{r as o}from"./prosemirror-keymap-e0a1e6d1.js";var a={};Object.defineProperty(a,"__esModule",{value:!0});var l,i,s=e,c=t,p=r,d=n,h=o;if("undefined"!=typeof WeakMap){var f=new WeakMap;l=function(e){return f.get(e)},i=function(e,t){return f.set(e,t),t}}else{var u=[],v=0;l=function(e){for(var t=0;t<u.length;t+=2)if(u[t]==e)return u[t+1]},i=function(e,t){return 10==v&&(v=0),u[v++]=e,u[v++]=t}}var m=function(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n},w=function(e,t,r,n){this.width=e,this.height=t,this.map=r,this.problems=n};function g(e){if(e.colwidth)return e.colwidth.slice();for(var t=[],r=0;r<e.colspan;r++)t.push(0);return t}w.prototype.findCell=function(e){for(var t=this,r=0;r<this.map.length;r++){var n=t.map[r];if(n==e){for(var o=r%t.width,a=r/t.width|0,l=o+1,i=a+1,s=1;l<this.width&&this.map[r+s]==n;s++)l++;for(var c=1;i<this.height&&this.map[r+this.width*c]==n;c++)i++;return new m(o,a,l,i)}}throw new RangeError("No cell with offset "+e+" found")},w.prototype.colCount=function(e){for(var t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError("No cell with offset "+e+" found")},w.prototype.nextCell=function(e,t,r){var n=this.findCell(e),o=n.left,a=n.right,l=n.top,i=n.bottom;return"horiz"==t?(r<0?0==o:a==this.width)?null:this.map[l*this.width+(r<0?o-1:a)]:(r<0?0==l:i==this.height)?null:this.map[o+this.width*(r<0?l-1:i)]},w.prototype.rectBetween=function(e,t){var r=this.findCell(e),n=r.left,o=r.right,a=r.top,l=r.bottom,i=this.findCell(t),s=i.left,c=i.right,p=i.top,d=i.bottom;return new m(Math.min(n,s),Math.min(a,p),Math.max(o,c),Math.max(l,d))},w.prototype.cellsInRect=function(e){for(var t=this,r=[],n={},o=e.top;o<e.bottom;o++)for(var a=e.left;a<e.right;a++){var l=o*t.width+a,i=t.map[l];n[i]||(n[i]=!0,a==e.left&&a&&t.map[l-1]==i||o==e.top&&o&&t.map[l-t.width]==i||r.push(i))}return r},w.prototype.positionAt=function(e,t,r){for(var n=this,o=0,a=0;;o++){var l=a+r.child(o).nodeSize;if(o==e){for(var i=t+e*n.width,s=(e+1)*n.width;i<s&&this.map[i]<a;)i++;return i==s?l-1:n.map[i]}a=l}},w.get=function(e){return l(e)||i(e,function(e){if("table"!=e.type.spec.tableRole)throw new RangeError("Not a table node: "+e.type.name);for(var t=function(e){for(var t=-1,r=!1,n=0;n<e.childCount;n++){var o=e.child(n),a=0;if(r)for(var l=0;l<n;l++)for(var i=e.child(l),s=0;s<i.childCount;s++){var c=i.child(s);l+c.attrs.rowspan>n&&(a+=c.attrs.colspan)}for(var p=0;p<o.childCount;p++){var d=o.child(p);a+=d.attrs.colspan,d.attrs.rowspan>1&&(r=!0)}-1==t?t=a:t!=a&&(t=Math.max(t,a))}return t}(e),r=e.childCount,n=[],o=0,a=null,l=[],i=0,s=t*r;i<s;i++)n[i]=0;for(var c=0,p=0;c<r;c++){var d=e.child(c);p++;for(var h=0;;h++){for(;o<n.length&&0!=n[o];)o++;if(h==d.childCount)break;for(var f=d.child(h),u=f.attrs,v=u.colspan,m=u.rowspan,C=u.colwidth,b=0;b<m;b++){if(b+c>=r){(a||(a=[])).push({type:"overlong_rowspan",pos:p,n:m-b});break}for(var y=o+b*t,S=0;S<v;S++){0==n[y+S]?n[y+S]=p:(a||(a=[])).push({type:"collision",row:c,pos:p,n:v-S});var A=C&&C[S];if(A){var $=(y+S)%t*2,M=l[$];null==M||M!=A&&1==l[$+1]?(l[$]=A,l[$+1]=1):M==A&&l[$+1]++}}}o+=v,p+=f.nodeSize}for(var R=(c+1)*t,x=0;o<R;)0==n[o++]&&x++;x&&(a||(a=[])).push({type:"missing",row:c,n:x}),p++}for(var z=new w(t,r,n,a),N=!1,_=0;!N&&_<l.length;_+=2)null!=l[_]&&l[_+1]<r&&(N=!0);N&&function(e,t,r){e.problems||(e.problems=[]);for(var n=0,o={};n<e.map.length;n++){var a=e.map[n];if(!o[a]){o[a]=!0;for(var l=r.nodeAt(a),i=null,s=0;s<l.attrs.colspan;s++){var c=t[2*((n+s)%e.width)];null==c||l.attrs.colwidth&&l.attrs.colwidth[s]==c||((i||(i=g(l.attrs)))[s]=c)}i&&e.problems.unshift({type:"colwidth mismatch",pos:a,colwidth:i})}}}(z,l,e);return z}(e))};var C=new s.PluginKey("selectingCells");function b(e){for(var t=e.depth-1;t>0;t--)if("row"==e.node(t).type.spec.tableRole)return e.node(0).resolve(e.before(t+1));return null}function y(e){for(var t=e.selection.$head,r=t.depth;r>0;r--)if("row"==t.node(r).type.spec.tableRole)return!0;return!1}function S(e){var t=e.selection;return t.$anchorCell?t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell:t.node&&"cell"==t.node.type.spec.tableRole?t.$anchor:b(t.$head)||function(e){for(var t=e.nodeAfter,r=e.pos;t;t=t.firstChild,r++){var n=t.type.spec.tableRole;if("cell"==n||"header_cell"==n)return e.doc.resolve(r)}for(var o=e.nodeBefore,a=e.pos;o;o=o.lastChild,a--){var l=o.type.spec.tableRole;if("cell"==l||"header_cell"==l)return e.doc.resolve(a-o.nodeSize)}}(t.$head)}function A(e){return"row"==e.parent.type.spec.tableRole&&e.nodeAfter}function $(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function M(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function R(e,t,r){var n=e.start(-1),o=w.get(e.node(-1)).nextCell(e.pos-n,t,r);return null==o?null:e.node(0).resolve(n+o)}function x(e,t,r){var n={};for(var o in e)n[o]=e[o];return n[t]=r,n}function z(e,t,r){void 0===r&&(r=1);var n=x(e,"colspan",e.colspan-r);return n.colwidth&&(n.colwidth=n.colwidth.slice(),n.colwidth.splice(t,r),n.colwidth.some((function(e){return e>0}))||(n.colwidth=null)),n}function N(e,t,r){void 0===r&&(r=1);var n=x(e,"colspan",e.colspan+r);if(n.colwidth){n.colwidth=n.colwidth.slice();for(var o=0;o<r;o++)n.colwidth.splice(t,0,0)}return n}var _=function(e){function t(t,r){void 0===r&&(r=t);var n=t.node(-1),o=w.get(n),a=t.start(-1),l=o.rectBetween(t.pos-a,r.pos-a),i=t.node(0),c=o.cellsInRect(l).filter((function(e){return e!=r.pos-a}));c.unshift(r.pos-a);var p=c.map((function(e){var t=n.nodeAt(e),r=e+a+1;return new s.SelectionRange(i.resolve(r),i.resolve(r+t.content.size))}));e.call(this,p[0].$from,p[0].$to,p),this.$anchorCell=t,this.$headCell=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.map=function(e,r){var n=e.resolve(r.map(this.$anchorCell.pos)),o=e.resolve(r.map(this.$headCell.pos));if(A(n)&&A(o)&&M(n,o)){var a=this.$anchorCell.node(-1)!=n.node(-1);return a&&this.isRowSelection()?t.rowSelection(n,o):a&&this.isColSelection()?t.colSelection(n,o):new t(n,o)}return s.TextSelection.between(n,o)},t.prototype.content=function(){for(var e=this.$anchorCell.node(-1),t=w.get(e),r=this.$anchorCell.start(-1),n=t.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},a=[],l=n.top;l<n.bottom;l++){for(var i=[],s=l*t.width+n.left,c=n.left;c<n.right;c++,s++){var d=t.map[s];if(!o[d]){o[d]=!0;var h=t.findCell(d),f=e.nodeAt(d),u=n.left-h.left,v=h.right-n.right;if(u>0||v>0){var m=f.attrs;u>0&&(m=z(m,0,u)),v>0&&(m=z(m,m.colspan-v,v)),f=h.left<n.left?f.type.createAndFill(m):f.type.create(m,f.content)}if(h.top<n.top||h.bottom>n.bottom){var g=x(f.attrs,"rowspan",Math.min(h.bottom,n.bottom)-Math.max(h.top,n.top));f=h.top<n.top?f.type.createAndFill(g):f.type.create(g,f.content)}i.push(f)}}a.push(e.child(l).copy(p.Fragment.from(i)))}var C=this.isColSelection()&&this.isRowSelection()?e:a;return new p.Slice(p.Fragment.from(C),1,1)},t.prototype.replace=function(t,r){void 0===r&&(r=p.Slice.empty);for(var n=t.steps.length,o=this.ranges,a=0;a<o.length;a++){var l=o[a],i=l.$from,s=l.$to,c=t.mapping.slice(n);t.replace(c.map(i.pos),c.map(s.pos),a?p.Slice.empty:r)}var d=e.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);d&&t.setSelection(d)},t.prototype.replaceWith=function(e,t){this.replace(e,new p.Slice(p.Fragment.from(t),0,0))},t.prototype.forEachCell=function(e){for(var t=this.$anchorCell.node(-1),r=w.get(t),n=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n)),a=0;a<o.length;a++)e(t.nodeAt(o[a]),n+o[a])},t.prototype.isColSelection=function(){var e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;var r=e+this.$anchorCell.nodeAfter.attrs.rowspan,n=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,n)==this.$headCell.node(-1).childCount},t.colSelection=function(e,r){void 0===r&&(r=e);var n=w.get(e.node(-1)),o=e.start(-1),a=n.findCell(e.pos-o),l=n.findCell(r.pos-o),i=e.node(0);return a.top<=l.top?(a.top>0&&(e=i.resolve(o+n.map[a.left])),l.bottom<n.height&&(r=i.resolve(o+n.map[n.width*(n.height-1)+l.right-1]))):(l.top>0&&(r=i.resolve(o+n.map[l.left])),a.bottom<n.height&&(e=i.resolve(o+n.map[n.width*(n.height-1)+a.right-1]))),new t(e,r)},t.prototype.isRowSelection=function(){var e=w.get(this.$anchorCell.node(-1)),t=this.$anchorCell.start(-1),r=e.colCount(this.$anchorCell.pos-t),n=e.colCount(this.$headCell.pos-t);if(Math.min(r,n)>0)return!1;var o=r+this.$anchorCell.nodeAfter.attrs.colspan,a=n+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,a)==e.width},t.prototype.eq=function(e){return e instanceof t&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos},t.rowSelection=function(e,r){void 0===r&&(r=e);var n=w.get(e.node(-1)),o=e.start(-1),a=n.findCell(e.pos-o),l=n.findCell(r.pos-o),i=e.node(0);return a.left<=l.left?(a.left>0&&(e=i.resolve(o+n.map[a.top*n.width])),l.right<n.width&&(r=i.resolve(o+n.map[n.width*(l.top+1)-1]))):(l.left>0&&(r=i.resolve(o+n.map[l.top*n.width])),a.right<n.width&&(e=i.resolve(o+n.map[n.width*(a.top+1)-1]))),new t(e,r)},t.prototype.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},t.fromJSON=function(e,r){return new t(e.resolve(r.anchor),e.resolve(r.head))},t.create=function(e,r,n){return void 0===n&&(n=r),new t(e.resolve(r),e.resolve(n))},t.prototype.getBookmark=function(){return new D(this.$anchorCell.pos,this.$headCell.pos)},t}(s.Selection);_.prototype.visible=!1,s.Selection.jsonID("cell",_);var D=function(e,t){this.anchor=e,this.head=t};function k(e){if(!(e.selection instanceof _))return null;var t=[];return e.selection.forEachCell((function(e,r){t.push(c.Decoration.node(r,r+e.nodeSize,{class:"selectedCell"}))})),c.DecorationSet.create(e.doc,t)}function E(e,t){var r=e.getAttribute("data-colwidth"),n=r&&/^\d+(,\d+)*$/.test(r)?r.split(",").map((function(e){return Number(e)})):null,o=Number(e.getAttribute("colspan")||1),a={colspan:o,rowspan:Number(e.getAttribute("rowspan")||1),colwidth:n&&n.length==o?n:null};for(var l in t){var i=t[l].getFromDOM,s=i&&i(e);null!=s&&(a[l]=s)}return a}function T(e,t){var r={};for(var n in 1!=e.attrs.colspan&&(r.colspan=e.attrs.colspan),1!=e.attrs.rowspan&&(r.rowspan=e.attrs.rowspan),e.attrs.colwidth&&(r["data-colwidth"]=e.attrs.colwidth.join(",")),t){var o=t[n].setDOMAttr;o&&o(e.attrs[n],r)}return r}function F(e){var t=e.cached.tableNodeTypes;if(!t)for(var r in t=e.cached.tableNodeTypes={},e.nodes){var n=e.nodes[r],o=n.spec.tableRole;o&&(t[o]=n)}return t}function H(e){if(!e.size)return null;for(var t=e.content,r=e.openStart,n=e.openEnd;1==t.childCount&&(r>0&&n>0||"table"==t.firstChild.type.spec.tableRole);)r--,n--,t=t.firstChild.content;var o=t.firstChild,a=o.type.spec.tableRole,l=o.type.schema,i=[];if("row"==a)for(var s=0;s<t.childCount;s++){var c=t.child(s).content,d=s?0:Math.max(0,r-1),h=s<t.childCount-1?0:Math.max(0,n-1);(d||h)&&(c=O(F(l).row,new p.Slice(c,d,h)).content),i.push(c)}else{if("cell"!=a&&"header_cell"!=a)return null;i.push(r||n?O(F(l).row,new p.Slice(t,r,n)).content:t)}return function(e,t){for(var r=[],n=0;n<t.length;n++)for(var o=t[n],a=o.childCount-1;a>=0;a--)for(var l=o.child(a).attrs,i=l.rowspan,s=l.colspan,c=n;c<n+i;c++)r[c]=(r[c]||0)+s;for(var d=0,h=0;h<r.length;h++)d=Math.max(d,r[h]);for(var f=0;f<r.length;f++)if(f>=t.length&&t.push(p.Fragment.empty),r[f]<d){for(var u=F(e).cell.createAndFill(),v=[],m=r[f];m<d;m++)v.push(u);t[f]=t[f].append(p.Fragment.from(v))}return{height:t.length,width:d,rows:t}}(l,i)}function O(e,t){var r=e.createAndFill();return new d.Transform(r).replace(0,r.content.size,t).doc}function L(e,t,r){var n=e.width,o=e.height,a=e.rows;if(n!=t){for(var l=[],i=[],s=0;s<a.length;s++){for(var c=a[s],d=[],h=l[s]||0,f=0;h<t;f++){var u=c.child(f%c.childCount);h+u.attrs.colspan>t&&(u=u.type.create(z(u.attrs,u.attrs.colspan,h+u.attrs.colspan-t),u.content)),d.push(u),h+=u.attrs.colspan;for(var v=1;v<u.attrs.rowspan;v++)l[s+v]=(l[s+v]||0)+u.attrs.colspan}i.push(p.Fragment.from(d))}a=i,n=t}if(o!=r){for(var m=[],w=0,g=0;w<r;w++,g++){for(var C=[],b=a[g%o],y=0;y<b.childCount;y++){var S=b.child(y);w+S.attrs.rowspan>r&&(S=S.type.create(x(S.attrs,"rowspan",r-S.attrs.rowspan),S.content)),C.push(S)}m.push(p.Fragment.from(C))}a=m,o=r}return{width:n,height:o,rows:a}}function B(e,t,r,n,o,a,l,i){if(0==l||l==t.height)return!1;for(var s=!1,c=o;c<a;c++){var p=l*t.width+c,d=t.map[p];if(t.map[p-t.width]==d){s=!0;var h=r.nodeAt(d),f=t.findCell(d),u=f.top,v=f.left;e.setNodeMarkup(e.mapping.slice(i).map(d+n),null,x(h.attrs,"rowspan",l-u)),e.insert(e.mapping.slice(i).map(t.positionAt(l,v,r)),h.type.createAndFill(x(h.attrs,"rowspan",u+h.attrs.rowspan-l))),c+=h.attrs.colspan-1}}return s}function W(e,t,r,n,o,a,l,i){if(0==l||l==t.width)return!1;for(var s=!1,c=o;c<a;c++){var p=c*t.width+l,d=t.map[p];if(t.map[p-1]==d){s=!0;var h=r.nodeAt(d),f=t.colCount(d),u=e.mapping.slice(i).map(d+n);e.setNodeMarkup(u,null,z(h.attrs,l-f,h.attrs.colspan-(l-f))),e.insert(u+h.nodeSize,h.type.createAndFill(z(h.attrs,0,l-f))),c+=h.attrs.rowspan-1}}return s}function P(e,t,r,n,o){var a=r?e.doc.nodeAt(r-1):e.doc,l=w.get(a),i=n.top,s=n.left,c=s+o.width,d=i+o.height,h=e.tr,f=0;function u(){a=r?h.doc.nodeAt(r-1):h.doc,l=w.get(a),f=h.mapping.maps.length}(function(e,t,r,n,o,a,l){var i,s,c=F(e.doc.type.schema);if(o>t.width)for(var d=0,h=0;d<t.height;d++){var f=r.child(d);h+=f.nodeSize;var u=[],v=void 0;v=null==f.lastChild||f.lastChild.type==c.cell?i||(i=c.cell.createAndFill()):s||(s=c.header_cell.createAndFill());for(var m=t.width;m<o;m++)u.push(v);e.insert(e.mapping.slice(l).map(h-1+n),u)}if(a>t.height){for(var w=[],g=0,C=(t.height-1)*t.width;g<Math.max(t.width,o);g++){var b=!(g>=t.width)&&r.nodeAt(t.map[C+g]).type==c.header_cell;w.push(b?s||(s=c.header_cell.createAndFill()):i||(i=c.cell.createAndFill()))}for(var y=c.row.create(null,p.Fragment.from(w)),S=[],A=t.height;A<a;A++)S.push(y);e.insert(e.mapping.slice(l).map(n+r.nodeSize-2),S)}return!(!i&&!s)})(h,l,a,r,c,d,f)&&u(),B(h,l,a,r,s,c,i,f)&&u(),B(h,l,a,r,s,c,d,f)&&u(),W(h,l,a,r,i,d,s,f)&&u(),W(h,l,a,r,i,d,c,f)&&u();for(var v=i;v<d;v++){var m=l.positionAt(v,s,a),g=l.positionAt(v,c,a);h.replace(h.mapping.slice(f).map(m+r),h.mapping.slice(f).map(g+r),new p.Slice(o.rows[v-i],0,0))}u(),h.setSelection(new _(h.doc.resolve(r+l.positionAt(i,s,a)),h.doc.resolve(r+l.positionAt(d-1,c-1,a)))),t(h)}D.prototype.map=function(e){return new D(e.map(this.anchor),e.map(this.head))},D.prototype.resolve=function(e){var t=e.resolve(this.anchor),r=e.resolve(this.head);return"row"==t.parent.type.spec.tableRole&&"row"==r.parent.type.spec.tableRole&&t.index()<t.parent.childCount&&r.index()<r.parent.childCount&&M(t,r)?new _(t,r):s.Selection.near(r,1)};var I=h.keydownHandler({ArrowLeft:j("horiz",-1),ArrowRight:j("horiz",1),ArrowUp:j("vert",-1),ArrowDown:j("vert",1),"Shift-ArrowLeft":X("horiz",-1),"Shift-ArrowRight":X("horiz",1),"Shift-ArrowUp":X("vert",-1),"Shift-ArrowDown":X("vert",1),Backspace:V,"Mod-Backspace":V,Delete:V,"Mod-Delete":V});function K(e,t,r){return!r.eq(e.selection)&&(t&&t(e.tr.setSelection(r).scrollIntoView()),!0)}function j(e,t){return function(r,n,o){var a=r.selection;if(a instanceof _)return K(r,n,s.Selection.near(a.$headCell,t));if("horiz"!=e&&!a.empty)return!1;var l=Y(o,e,t);if(null==l)return!1;if("horiz"==e)return K(r,n,s.Selection.near(r.doc.resolve(a.head+t),t));var i,c=r.doc.resolve(l),p=R(c,e,t);return i=p?s.Selection.near(p,1):t<0?s.Selection.near(r.doc.resolve(c.before(-1)),-1):s.Selection.near(r.doc.resolve(c.after(-1)),1),K(r,n,i)}}function X(e,t){return function(r,n,o){var a=r.selection;if(!(a instanceof _)){var l=Y(o,e,t);if(null==l)return!1;a=new _(r.doc.resolve(l))}var i=R(a.$headCell,e,t);return!!i&&K(r,n,new _(a.$anchorCell,i))}}function V(e,t){var r=e.selection;if(!(r instanceof _))return!1;if(t){var n=e.tr,o=F(e.schema).cell.createAndFill().content;r.forEachCell((function(e,t){e.content.eq(o)||n.replace(n.mapping.map(t+1),n.mapping.map(t+e.nodeSize-1),new p.Slice(o,0,0))})),n.docChanged&&t(n)}return!0}function q(e,t){var r=b(e.state.doc.resolve(t));return!!r&&(e.dispatch(e.state.tr.setSelection(new _(r))),!0)}function J(e,t,r){if(!y(e.state))return!1;var n=H(r),o=e.state.selection;if(o instanceof _){n||(n={width:1,height:1,rows:[p.Fragment.from(O(F(e.state.schema).cell,r))]});var a=o.$anchorCell.node(-1),l=o.$anchorCell.start(-1),i=w.get(a).rectBetween(o.$anchorCell.pos-l,o.$headCell.pos-l);return n=L(n,i.right-i.left,i.bottom-i.top),P(e.state,e.dispatch,l,i,n),!0}if(n){var s=S(e.state),c=s.start(-1);return P(e.state,e.dispatch,c,w.get(s.node(-1)).findCell(s.pos-c),n),!0}return!1}function U(e,t){if(!t.ctrlKey&&!t.metaKey){var r,n=G(e,t.target);if(t.shiftKey&&e.state.selection instanceof _)o(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&n&&null!=(r=b(e.state.selection.$anchor))&&Q(e,t).pos!=r.pos)o(r,t),t.preventDefault();else if(!n)return;e.root.addEventListener("mouseup",a),e.root.addEventListener("dragstart",a),e.root.addEventListener("mousemove",l)}function o(t,r){var n=Q(e,r),o=null==C.getState(e.state);if(!n||!M(t,n)){if(!o)return;n=t}var a=new _(t,n);if(o||!e.state.selection.eq(a)){var l=e.state.tr.setSelection(a);o&&l.setMeta(C,t.pos),e.dispatch(l)}}function a(){e.root.removeEventListener("mouseup",a),e.root.removeEventListener("dragstart",a),e.root.removeEventListener("mousemove",l),null!=C.getState(e.state)&&e.dispatch(e.state.tr.setMeta(C,-1))}function l(r){var l,i=C.getState(e.state);if(null!=i)l=e.state.doc.resolve(i);else if(G(e,r.target)!=n&&!(l=Q(e,t)))return a();l&&o(l,r)}}function Y(e,t,r){if(!(e.state.selection instanceof s.TextSelection))return null;for(var n=e.state.selection.$head,o=n.depth-1;o>=0;o--){var a=n.node(o);if((r<0?n.index(o):n.indexAfter(o))!=(r<0?0:a.childCount))return null;if("cell"==a.type.spec.tableRole||"header_cell"==a.type.spec.tableRole){var l=n.before(o),i="vert"==t?r>0?"down":"up":r>0?"right":"left";return e.endOfTextblock(i)?l:null}}return null}function G(e,t){for(;t&&t!=e.dom;t=t.parentNode)if("TD"==t.nodeName||"TH"==t.nodeName)return t}function Q(e,t){var r=e.posAtCoords({left:t.clientX,top:t.clientY});return r&&r?b(e.state.doc.resolve(r.pos)):null}var Z=new s.PluginKey("fix-tables");function ee(e,t,r,n){var o=e.childCount,a=t.childCount;e:for(var l=0,i=0;l<a;l++){for(var s=t.child(l),c=i,p=Math.min(o,l+3);c<p;c++)if(e.child(c)==s){i=c+1,r+=s.nodeSize;continue e}n(s,r),i<o&&e.child(i).sameMarkup(s)?ee(e.child(i),s,r+1,n):s.nodesBetween(0,s.content.size,n,r+1),r+=s.nodeSize}}function te(e,t){var r,n=function(t,n){"table"==t.type.spec.tableRole&&(r=function(e,t,r,n){var o=w.get(t);if(!o.problems)return n;n||(n=e.tr);for(var a,l,i=[],s=0;s<o.height;s++)i.push(0);for(var c=0;c<o.problems.length;c++){var p=o.problems[c];if("collision"==p.type){for(var d=t.nodeAt(p.pos),h=0;h<d.attrs.rowspan;h++)i[p.row+h]+=p.n;n.setNodeMarkup(n.mapping.map(r+1+p.pos),null,z(d.attrs,d.attrs.colspan-p.n,p.n))}else if("missing"==p.type)i[p.row]+=p.n;else if("overlong_rowspan"==p.type){var f=t.nodeAt(p.pos);n.setNodeMarkup(n.mapping.map(r+1+p.pos),null,x(f.attrs,"rowspan",f.attrs.rowspan-p.n))}else if("colwidth mismatch"==p.type){var u=t.nodeAt(p.pos);n.setNodeMarkup(n.mapping.map(r+1+p.pos),null,x(u.attrs,"colwidth",p.colwidth))}}for(var v=0;v<i.length;v++)i[v]&&(null==a&&(a=v),l=v);for(var m=0,g=r+1;m<o.height;m++){var C=t.child(m),b=g+C.nodeSize,y=i[m];if(y>0){var S="cell";C.firstChild&&(S=C.firstChild.type.spec.tableRole);for(var A=[],$=0;$<y;$++)A.push(F(e.schema)[S].createAndFill());var M=0!=m&&a!=m-1||l!=m?b-1:g+1;n.insert(n.mapping.map(M),A)}g=b}return n.setMeta(Z,{fixTables:!0})}(e,t,n,r))};return t?t.doc!=e.doc&&ee(t.doc,e.doc,0,n):e.doc.descendants(n),r}function re(e){var t,r=e.selection,n=S(e),o=n.node(-1),a=n.start(-1),l=w.get(o);return(t=r instanceof _?l.rectBetween(r.$anchorCell.pos-a,r.$headCell.pos-a):l.findCell(n.pos-a)).tableStart=a,t.map=l,t.table=o,t}function ne(e,t,r){var n=t.map,o=t.tableStart,a=t.table,l=r>0?-1:0;(function(e,t,r){for(var n=F(t.type.schema).header_cell,o=0;o<e.height;o++)if(t.nodeAt(e.map[r+o*e.width]).type!=n)return!1;return!0})(n,a,r+l)&&(l=0==r||r==n.width?null:0);for(var i=0;i<n.height;i++){var s=i*n.width+r;if(r>0&&r<n.width&&n.map[s-1]==n.map[s]){var c=n.map[s],p=a.nodeAt(c);e.setNodeMarkup(e.mapping.map(o+c),null,N(p.attrs,r-n.colCount(c))),i+=p.attrs.rowspan-1}else{var d=null==l?F(a.type.schema).cell:a.nodeAt(n.map[s+l]).type,h=n.positionAt(i,r,a);e.insert(e.mapping.map(o+h),d.createAndFill())}}return e}function oe(e,t,r){for(var n=t.map,o=t.table,a=t.tableStart,l=e.mapping.maps.length,i=0;i<n.height;){var s=i*n.width+r,c=n.map[s],p=o.nodeAt(c);if(r>0&&n.map[s-1]==c||r<n.width-1&&n.map[s+1]==c)e.setNodeMarkup(e.mapping.slice(l).map(a+c),null,z(p.attrs,r-n.colCount(c)));else{var d=e.mapping.slice(l).map(a+c);e.delete(d,d+p.nodeSize)}i+=p.attrs.rowspan}}function ae(e,t,r){for(var n=t.map,o=t.tableStart,a=t.table,l=o,i=0;i<r;i++)l+=a.child(i).nodeSize;var s=[],c=r>0?-1:0;(function(e,t,r){for(var n=F(t.type.schema).header_cell,o=0;o<e.width;o++)if(t.nodeAt(e.map[o+r*e.width]).type!=n)return!1;return!0})(n,a,r+c)&&(c=0==r||r==n.height?null:0);for(var p=0,d=n.width*r;p<n.width;p++,d++)if(r>0&&r<n.height&&n.map[d]==n.map[d-n.width]){var h=n.map[d],f=a.nodeAt(h).attrs;e.setNodeMarkup(o+h,null,x(f,"rowspan",f.rowspan+1)),p+=f.colspan-1}else{var u=null==c?F(a.type.schema).cell:a.nodeAt(n.map[d+c*n.width]).type;s.push(u.createAndFill())}return e.insert(l,F(a.type.schema).row.create(null,s)),e}function le(e,t,r){for(var n=t.map,o=t.table,a=t.tableStart,l=0,i=0;i<r;i++)l+=o.child(i).nodeSize;var s=l+o.child(r).nodeSize,c=e.mapping.maps.length;e.delete(l+a,s+a);for(var p=0,d=r*n.width;p<n.width;p++,d++){var h=n.map[d];if(r>0&&h==n.map[d-n.width]){var f=o.nodeAt(h).attrs;e.setNodeMarkup(e.mapping.slice(c).map(h+a),null,x(f,"rowspan",f.rowspan-1)),p+=f.colspan-1}else if(r<n.width&&h==n.map[d+n.width]){var u=o.nodeAt(h),v=u.type.create(x(u.attrs,"rowspan",u.attrs.rowspan-1),u.content),m=n.positionAt(r+1,p,o);e.insert(e.mapping.slice(c).map(a+m),v),p+=u.attrs.colspan-1}}}function ie(e){var t=e.content;return 1==t.childCount&&t.firstChild.isTextblock&&0==t.firstChild.childCount}function se(e){return function(t,r){var n,o,a=t.selection;if(a instanceof _){if(a.$anchorCell.pos!=a.$headCell.pos)return!1;n=a.$anchorCell.nodeAfter,o=a.$anchorCell.pos}else{if(!(n=function(e){for(var t=e.depth;t>0;t--){var r=e.node(t).type.spec.tableRole;if("cell"===r||"header_cell"===r)return e.node(t)}return null}(a.$from)))return!1;o=b(a.$from).pos}if(1==n.attrs.colspan&&1==n.attrs.rowspan)return!1;if(r){var l=n.attrs,i=[],s=l.colwidth;l.rowspan>1&&(l=x(l,"rowspan",1)),l.colspan>1&&(l=x(l,"colspan",1));for(var c,p=re(t),d=t.tr,h=0;h<p.right-p.left;h++)i.push(s?x(l,"colwidth",s&&s[h]?[s[h]]:null):l);for(var f=p.top;f<p.bottom;f++){var u=p.map.positionAt(f,p.left,p.table);f==p.top&&(u+=n.nodeSize);for(var v=p.left,m=0;v<p.right;v++,m++)v==p.left&&f==p.top||d.insert(c=d.mapping.map(u+p.tableStart,1),e({node:n,row:f,col:v}).createAndFill(i[m]))}d.setNodeMarkup(o,e({node:n,row:p.top,col:p.left}),i[0]),a instanceof _&&d.setSelection(new _(d.doc.resolve(a.$anchorCell.pos),c&&d.doc.resolve(c))),r(d)}return!0}}function ce(e,t,r){for(var n=t.map.cellsInRect({left:0,top:0,right:"row"==e?t.map.width:1,bottom:"column"==e?t.map.height:1}),o=0;o<n.length;o++){var a=t.table.nodeAt(n[o]);if(a&&a.type!==r.header_cell)return!1}return!0}function pe(e,t){return(t=t||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(e){return function(t,r){if(!y(t))return!1;if(r){for(var n=F(t.schema),o=re(t),a=t.tr,l=o.map.cellsInRect("column"==e?new m(o.left,0,o.right,o.map.height):"row"==e?new m(0,o.top,o.map.width,o.bottom):o),i=l.map((function(e){return o.table.nodeAt(e)})),s=0;s<l.length;s++)i[s].type==n.header_cell&&a.setNodeMarkup(o.tableStart+l[s],n.cell,i[s].attrs);if(0==a.steps.length)for(var c=0;c<l.length;c++)a.setNodeMarkup(o.tableStart+l[c],n.header_cell,i[c].attrs);r(a)}return!0}}(e):function(t,r){if(!y(t))return!1;if(r){var n=F(t.schema),o=re(t),a=t.tr,l=ce("row",o,n),i=ce("column",o,n),s=("column"===e?l:"row"===e&&i)?1:0,c="column"==e?new m(0,s,1,o.map.height):"row"==e?new m(s,0,o.map.width,1):o,p="column"==e?i?n.cell:n.header_cell:"row"==e?l?n.cell:n.header_cell:n.cell;o.map.cellsInRect(c).forEach((function(e){var t=e+o.tableStart,r=a.doc.nodeAt(t);r&&a.setNodeMarkup(t,p,r.attrs)})),r(a)}return!0}}var de=pe("row",{useDeprecatedLogic:!0}),he=pe("column",{useDeprecatedLogic:!0}),fe=pe("cell",{useDeprecatedLogic:!0});var ue=function(e,t){this.node=e,this.cellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ve(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))};function ve(e,t,r,n,o,a){for(var l=0,i=!0,s=t.firstChild,c=e.firstChild,p=0,d=0;p<c.childCount;p++)for(var h=c.child(p).attrs,f=h.colspan,u=h.colwidth,v=0;v<f;v++,d++){var m=o==d?a:u&&u[v],w=m?m+"px":"";l+=m||n,m||(i=!1),s?(s.style.width!=w&&(s.style.width=w),s=s.nextSibling):t.appendChild(document.createElement("col")).style.width=w}for(;s;){var g=s.nextSibling;s.parentNode.removeChild(s),s=g}i?(r.style.width=l+"px",r.style.minWidth=""):(r.style.width="",r.style.minWidth=l+"px")}ue.prototype.update=function(e){return e.type==this.node.type&&(this.node=e,ve(e,this.colgroup,this.table,this.cellMinWidth),!0)},ue.prototype.ignoreMutation=function(e){return"attributes"==e.type&&(e.target==this.table||this.colgroup.contains(e.target))};var me=new s.PluginKey("tableColumnResizing");var we=function(e,t){this.activeHandle=e,this.dragging=t};function ge(e,t,r){var n=e.posAtCoords({left:t.clientX,top:t.clientY}).pos,o=b(e.state.doc.resolve(n));if(!o)return-1;if("right"==r)return o.pos;var a=w.get(o.node(-1)),l=o.start(-1),i=a.map.indexOf(o.pos-l);return i%a.width==0?-1:l+a.map[i-1]}function Ce(e,t,r){var n=t.clientX-e.startX;return Math.max(r,e.startWidth+n)}function be(e,t){e.dispatch(e.state.tr.setMeta(me,{setHandle:t}))}function ye(e){for(var t=[],r=0;r<e;r++)t.push(0);return t}we.prototype.apply=function(e){var t=this,r=e.getMeta(me);if(r&&null!=r.setHandle)return new we(r.setHandle,null);if(r&&void 0!==r.setDragging)return new we(t.activeHandle,r.setDragging);if(t.activeHandle>-1&&e.docChanged){var n=e.mapping.map(t.activeHandle,-1);A(e.doc.resolve(n))||(n=null),t=new we(n,t.dragging)}return t},a.tableEditing=function(e){void 0===e&&(e={});var t=e.allowTableNodeSelection;return void 0===t&&(t=!1),new s.Plugin({key:C,state:{init:function(){return null},apply:function(e,t){var r=e.getMeta(C);if(null!=r)return-1==r?null:r;if(null==t||!e.docChanged)return t;var n=e.mapping.mapResult(t),o=n.deleted,a=n.pos;return o?null:a}},props:{decorations:k,handleDOMEvents:{mousedown:U},createSelectionBetween:function(e){if(null!=C.getState(e.state))return e.state.selection},handleTripleClick:q,handleKeyDown:I,handlePaste:J},appendTransaction:function(e,r,n){return function(e,t,r){var n,o,a=(t||e).selection,l=(t||e).doc;if(a instanceof s.NodeSelection&&(o=a.node.type.spec.tableRole)){if("cell"==o||"header_cell"==o)n=_.create(l,a.from);else if("row"==o){var i=l.resolve(a.from+1);n=_.rowSelection(i,i)}else if(!r){var c=w.get(a.node),p=a.from+1,d=p+c.map[c.width*c.height-1];n=_.create(l,p+1,d)}}else a instanceof s.TextSelection&&function(e){var t=e.$from,r=e.$to;if(t.pos==r.pos||t.pos<t.pos-6)return!1;for(var n=t.pos,o=r.pos,a=t.depth;a>=0&&!(t.after(a+1)<t.end(a));a--,n++);for(var l=r.depth;l>=0&&!(r.before(l+1)>r.start(l));l--,o--);return n==o&&/row|table/.test(t.node(a).type.spec.tableRole)}(a)?n=s.TextSelection.create(l,a.from):a instanceof s.TextSelection&&function(e){for(var t,r,n=e.$from,o=e.$to,a=n.depth;a>0;a--){var l=n.node(a);if("cell"===l.type.spec.tableRole||"header_cell"===l.type.spec.tableRole){t=l;break}}for(var i=o.depth;i>0;i--){var s=o.node(i);if("cell"===s.type.spec.tableRole||"header_cell"===s.type.spec.tableRole){r=s;break}}return t!==r&&0===o.parentOffset}(a)&&(n=s.TextSelection.create(l,a.$from.start(),a.$from.end()));return n&&(t||(t=e.tr)).setSelection(n),t}(n,te(n,r),t)}})},a.fixTables=te,a.handlePaste=J,a.fixTablesKey=Z,a.tableEditingKey=C,a.cellAround=b,a.isInTable=y,a.selectionCell=S,a.moveCellForward=$,a.inSameTable=M,a.findCell=function(e){return w.get(e.node(-1)).findCell(e.pos-e.start(-1))},a.colCount=function(e){return w.get(e.node(-1)).colCount(e.pos-e.start(-1))},a.nextCell=R,a.tableNodes=function(e){var t=e.cellAttributes||{},r={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(var n in t)r[n]={default:t[n].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:e.tableGroup,parseDOM:[{tag:"table"}],toDOM:function(){return["table",["tbody",0]]}},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:function(){return["tr",0]}},table_cell:{content:e.cellContent,attrs:r,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:function(e){return E(e,t)}}],toDOM:function(e){return["td",T(e,t),0]}},table_header:{content:e.cellContent,attrs:r,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:function(e){return E(e,t)}}],toDOM:function(e){return["th",T(e,t),0]}}}},a.CellSelection=_,a.TableMap=w,a.columnResizing=function(e){void 0===e&&(e={});var t=e.handleWidth;void 0===t&&(t=5);var r=e.cellMinWidth;void 0===r&&(r=25);var n=e.View;void 0===n&&(n=ue);var o=e.lastColumnResizable;return void 0===o&&(o=!0),new s.Plugin({key:me,state:{init:function(e,t){return this.spec.props.nodeViews[F(t.schema).table.name]=function(e,t){return new n(e,r,t)},new we(-1,!1)},apply:function(e,t){return t.apply(e)}},props:{attributes:function(e){return me.getState(e).activeHandle>-1?{class:"resize-cursor"}:null},handleDOMEvents:{mousemove:function(e,r){!function(e,t,r,n,o){var a=me.getState(e.state);if(!a.dragging){var l=function(e){for(;e&&"TD"!=e.nodeName&&"TH"!=e.nodeName;)e=e.classList.contains("ProseMirror")?null:e.parentNode;return e}(t.target),i=-1;if(l){var s=l.getBoundingClientRect(),c=s.left,p=s.right;t.clientX-c<=r?i=ge(e,t,"left"):p-t.clientX<=r&&(i=ge(e,t,"right"))}if(i!=a.activeHandle){if(!o&&-1!==i){var d=e.state.doc.resolve(i),h=d.node(-1),f=w.get(h),u=d.start(-1);if(f.colCount(d.pos-u)+d.nodeAfter.attrs.colspan-1==f.width-1)return}be(e,i)}}}(e,r,t,0,o)},mouseleave:function(e){!function(e){var t=me.getState(e.state);t.activeHandle>-1&&!t.dragging&&be(e,-1)}(e)},mousedown:function(e,t){!function(e,t,r){var n=me.getState(e.state);if(-1==n.activeHandle||n.dragging)return!1;var o=e.state.doc.nodeAt(n.activeHandle),a=function(e,t,r){var n=r.colspan,o=r.colwidth,a=o&&o[o.length-1];if(a)return a;var l=e.domAtPos(t),i=l.node.childNodes[l.offset].offsetWidth,s=n;if(o)for(var c=0;c<n;c++)o[c]&&(i-=o[c],s--);return i/s}(e,n.activeHandle,o.attrs);function l(t){window.removeEventListener("mouseup",l),window.removeEventListener("mousemove",i);var n=me.getState(e.state);n.dragging&&(!function(e,t,r){for(var n=e.state.doc.resolve(t),o=n.node(-1),a=w.get(o),l=n.start(-1),i=a.colCount(n.pos-l)+n.nodeAfter.attrs.colspan-1,s=e.state.tr,c=0;c<a.height;c++){var p=c*a.width+i;if(!c||a.map[p]!=a.map[p-a.width]){var d=a.map[p],h=o.nodeAt(d).attrs,f=1==h.colspan?0:i-a.colCount(d);if(!h.colwidth||h.colwidth[f]!=r){var u=h.colwidth?h.colwidth.slice():ye(h.colspan);u[f]=r,s.setNodeMarkup(l+d,null,x(h,"colwidth",u))}}}s.docChanged&&e.dispatch(s)}(e,n.activeHandle,Ce(n.dragging,t,r)),e.dispatch(e.state.tr.setMeta(me,{setDragging:null})))}function i(t){if(!t.which)return l(t);var n=me.getState(e.state),o=Ce(n.dragging,t,r);!function(e,t,r,n){var o=e.state.doc.resolve(t),a=o.node(-1),l=o.start(-1),i=w.get(a).colCount(o.pos-l)+o.nodeAfter.attrs.colspan-1,s=e.domAtPos(o.start(-1)).node;for(;"TABLE"!=s.nodeName;)s=s.parentNode;ve(a,s.firstChild,s,n,i,r)}(e,n.activeHandle,o,r)}e.dispatch(e.state.tr.setMeta(me,{setDragging:{startX:t.clientX,startWidth:a}})),window.addEventListener("mouseup",l),window.addEventListener("mousemove",i),t.preventDefault()}(e,t,r)}},decorations:function(e){var t=me.getState(e);if(t.activeHandle>-1)return function(e,t){for(var r=[],n=e.doc.resolve(t),o=n.node(-1),a=w.get(o),l=n.start(-1),i=a.colCount(n.pos-l)+n.nodeAfter.attrs.colspan,s=0;s<a.height;s++){var p=i+s*a.width-1;if(!(i!=a.width&&a.map[p]==a.map[p+1]||0!=s&&a.map[p-1]==a.map[p-1-a.width])){var d=a.map[p],h=l+d+o.nodeAt(d).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",r.push(c.Decoration.widget(h,f))}}return c.DecorationSet.create(e.doc,r)}(e,t.activeHandle)},nodeViews:{}}})},a.columnResizingPluginKey=me,a.updateColumnsOnResize=ve,a.__pastedCells=H,a.__insertCells=P,a.__clipCells=L,a.addColumn=ne,a.addColumnBefore=function(e,t){if(!y(e))return!1;if(t){var r=re(e);t(ne(e.tr,r,r.left))}return!0},a.addColumnAfter=function(e,t){if(!y(e))return!1;if(t){var r=re(e);t(ne(e.tr,r,r.right))}return!0},a.removeColumn=oe,a.deleteColumn=function(e,t){if(!y(e))return!1;if(t){var r=re(e),n=e.tr;if(0==r.left&&r.right==r.map.width)return!1;for(var o=r.right-1;oe(n,r,o),o!=r.left;o--)r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc,r.map=w.get(r.table);t(n)}return!0},a.addRow=ae,a.addRowBefore=function(e,t){if(!y(e))return!1;if(t){var r=re(e);t(ae(e.tr,r,r.top))}return!0},a.addRowAfter=function(e,t){if(!y(e))return!1;if(t){var r=re(e);t(ae(e.tr,r,r.bottom))}return!0},a.removeRow=le,a.deleteRow=function(e,t){if(!y(e))return!1;if(t){var r=re(e),n=e.tr;if(0==r.top&&r.bottom==r.map.height)return!1;for(var o=r.bottom-1;le(n,r,o),o!=r.top;o--)r.table=r.tableStart?n.doc.nodeAt(r.tableStart-1):n.doc,r.map=w.get(r.table);t(n)}return!0};var Se=a.mergeCells=function(e,t){var r=e.selection;if(!(r instanceof _)||r.$anchorCell.pos==r.$headCell.pos)return!1;var n=re(e),o=n.map;if(function(e,t){for(var r=e.width,n=e.height,o=e.map,a=t.top*r+t.left,l=a,i=(t.bottom-1)*r+t.left,s=a+(t.right-t.left-1),c=t.top;c<t.bottom;c++){if(t.left>0&&o[l]==o[l-1]||t.right<r&&o[s]==o[s+1])return!0;l+=r,s+=r}for(var p=t.left;p<t.right;p++){if(t.top>0&&o[a]==o[a-r]||t.bottom<n&&o[i]==o[i+r])return!0;a++,i++}return!1}(o,n))return!1;if(t){for(var a,l,i=e.tr,s={},c=p.Fragment.empty,d=n.top;d<n.bottom;d++)for(var h=n.left;h<n.right;h++){var f=o.map[d*o.width+h],u=n.table.nodeAt(f);if(!s[f])if(s[f]=!0,null==a)a=f,l=u;else{ie(u)||(c=c.append(u.content));var v=i.mapping.map(f+n.tableStart);i.delete(v,v+u.nodeSize)}}if(i.setNodeMarkup(a+n.tableStart,null,x(N(l.attrs,l.attrs.colspan,n.right-n.left-l.attrs.colspan),"rowspan",n.bottom-n.top)),c.size){var m=a+1+l.content.size,w=ie(l)?a+1:m;i.replaceWith(w+n.tableStart,m+n.tableStart,c)}i.setSelection(new _(i.doc.resolve(a+n.tableStart))),t(i)}return!0},Ae=a.splitCell=function(e,t){var r=F(e.schema);return se((function(e){var t=e.node;return r[t.type.spec.tableRole]}))(e,t)};a.splitCellWithType=se,a.setCellAttr=function(e,t){return function(r,n){if(!y(r))return!1;var o=S(r);if(o.nodeAfter.attrs[e]===t)return!1;if(n){var a=r.tr;r.selection instanceof _?r.selection.forEachCell((function(r,n){r.attrs[e]!==t&&a.setNodeMarkup(n,null,x(r.attrs,e,t))})):a.setNodeMarkup(o.pos,null,x(o.nodeAfter.attrs,e,t)),n(a)}return!0}},a.toggleHeader=pe,a.toggleHeaderRow=de,a.toggleHeaderColumn=he,a.toggleHeaderCell=fe,a.goToNextCell=function(e){return function(t,r){if(!y(t))return!1;var n=function(e,t){if(t<0){var r=e.nodeBefore;if(r)return e.pos-r.nodeSize;for(var n=e.index(-1)-1,o=e.before();n>=0;n--){var a=e.node(-1).child(n);if(a.childCount)return o-1-a.lastChild.nodeSize;o-=a.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;for(var l=e.node(-1),i=e.indexAfter(-1),s=e.after();i<l.childCount;i++){var c=l.child(i);if(c.childCount)return s+1;s+=c.nodeSize}}}(S(t),e);if(null!=n){if(r){var o=t.doc.resolve(n);r(t.tr.setSelection(s.TextSelection.between(o,$(o))).scrollIntoView())}return!0}}},a.deleteTable=function(e,t){for(var r=e.selection.$anchor,n=r.depth;n>0;n--){if("table"==r.node(n).type.spec.tableRole)return t&&t(e.tr.delete(r.before(n),r.after(n)).scrollIntoView()),!0}return!1};export{a as d,Se as m,Ae as s};
