import{N as t,M as e,E as n}from"./tiptap-cd99e86f.js";import{t as o,a as r,b as s,n as l,s as a,m as i,c,u as p,r as d,p as h}from"./tiptap-commands-9e395e16.js";import"./highlight.js-45c9f23d.js";import"./fault-4bc10d66.js";import{D as u,a as f}from"./prosemirror-view-e30b2d7a.js";import{c as m,g,d as w}from"./tiptap-utils-1e7277fa.js";import{a as b,S as y,b as C,T as v,P as A,N as M}from"./prosemirror-state-aff6b6a5.js";import{F as S,S as $}from"./prosemirror-model-e99bf1dc.js";import{k}from"./prosemirror-keymap-e0a1e6d1.js";import{T as R}from"./prosemirror-transform-0ba15ba3.js";import{h as D,u as _,r as x,a as O,b as N}from"./prosemirror-history-094ab62a.js";import{w as z,t as E}from"./prosemirror-inputrules-51b7290b.js";import{s as T,t as H,c as L,e as W}from"./prosemirror-commands-994280f1.js";import{s as j,a as F,l as B}from"./prosemirror-schema-list-a2d0a333.js";var I,V;if("undefined"!=typeof WeakMap){let t=new WeakMap;I=e=>t.get(e),V=(e,n)=>(t.set(e,n),n)}else{const t=[],e=10;let n=0;I=e=>{for(let n=0;n<t.length;n+=2)if(t[n]==e)return t[n+1]},V=(o,r)=>(n==e&&(n=0),t[n++]=o,t[n++]=r)}var X=class{constructor(t,e,n,o){this.width=t,this.height=e,this.map=n,this.problems=o}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const o=e%this.width,r=e/this.width|0;let s=o+1,l=r+1;for(let t=1;s<this.width&&this.map[e+t]==n;t++)s++;for(let t=1;l<this.height&&this.map[e+this.width*t]==n;t++)l++;return{left:o,top:r,right:s,bottom:l}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:o,right:r,top:s,bottom:l}=this.findCell(t);return"horiz"==e?(n<0?0==o:r==this.width)?null:this.map[s*this.width+(n<0?o-1:r)]:(n<0?0==s:l==this.height)?null:this.map[o+this.width*(n<0?s-1:l)]}rectBetween(t,e){const{left:n,right:o,top:r,bottom:s}=this.findCell(t),{left:l,right:a,top:i,bottom:c}=this.findCell(e);return{left:Math.min(n,l),top:Math.min(r,i),right:Math.max(o,a),bottom:Math.max(s,c)}}cellsInRect(t){const e=[],n={};for(let o=t.top;o<t.bottom;o++)for(let r=t.left;r<t.right;r++){const s=o*this.width+r,l=this.map[s];n[l]||(n[l]=!0,r==t.left&&r&&this.map[s-1]==l||o==t.top&&o&&this.map[s-this.width]==l||e.push(l))}return e}positionAt(t,e,n){for(let o=0,r=0;;o++){const s=r+n.child(o).nodeSize;if(o==t){let n=e+t*this.width;const o=(t+1)*this.width;for(;n<o&&this.map[n]<r;)n++;return n==o?s-1:this.map[n]}r=s}}static get(t){return I(t)||V(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);const e=function(t){let e=-1,n=!1;for(let o=0;o<t.childCount;o++){const r=t.child(o);let s=0;if(n)for(let e=0;e<o;e++){const n=t.child(e);for(let t=0;t<n.childCount;t++){const r=n.child(t);e+r.attrs.rowspan>o&&(s+=r.attrs.colspan)}}for(let t=0;t<r.childCount;t++){const e=r.child(t);s+=e.attrs.colspan,e.attrs.rowspan>1&&(n=!0)}-1==e?e=s:e!=s&&(e=Math.max(e,s))}return e}(t),n=t.childCount,o=[];let r=0,s=null;const l=[];for(let c=0,p=e*n;c<p;c++)o[c]=0;for(let c=0,p=0;c<n;c++){const a=t.child(c);p++;for(let t=0;;t++){for(;r<o.length&&0!=o[r];)r++;if(t==a.childCount)break;const i=a.child(t),{colspan:d,rowspan:h,colwidth:u}=i.attrs;for(let t=0;t<h;t++){if(t+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:p,n:h-t});break}const a=r+t*e;for(let t=0;t<d;t++){0==o[a+t]?o[a+t]=p:(s||(s=[])).push({type:"collision",row:c,pos:p,n:d-t});const n=u&&u[t];if(n){const o=(a+t)%e*2,r=l[o];null==r||r!=n&&1==l[o+1]?(l[o]=n,l[o+1]=1):r==n&&l[o+1]++}}}r+=d,p+=i.nodeSize}const i=(c+1)*e;let d=0;for(;r<i;)0==o[r++]&&d++;d&&(s||(s=[])).push({type:"missing",row:c,n:d}),p++}const a=new X(e,n,o,s);let i=!1;for(let c=0;!i&&c<l.length;c+=2)null!=l[c]&&l[c+1]<n&&(i=!0);i&&function(t,e,n){t.problems||(t.problems=[]);const o={};for(let r=0;r<t.map.length;r++){const s=t.map[r];if(o[s])continue;o[s]=!0;const l=n.nodeAt(s);if(!l)throw new RangeError(`No cell with offset ${s} found`);let a=null;const i=l.attrs;for(let n=0;n<i.colspan;n++){const o=e[2*((r+n)%t.width)];null==o||i.colwidth&&i.colwidth[n]==o||((a||(a=q(i)))[n]=o)}a&&t.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:a})}}(a,l,t);return a}(t))}};function q(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function P(t,e){if("string"==typeof t)return{};const n=t.getAttribute("data-colwidth"),o=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map((t=>Number(t))):null,r=Number(t.getAttribute("colspan")||1),s={colspan:r,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:o&&o.length==r?o:null};for(const l in e){const n=e[l].getFromDOM,o=n&&n(t);null!=o&&(s[l]=o)}return s}function K(t,e){const n={};1!=t.attrs.colspan&&(n.colspan=t.attrs.colspan),1!=t.attrs.rowspan&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(","));for(const o in e){const r=e[o].setDOMAttr;r&&r(t.attrs[o],n)}return n}function G(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const o=t.nodes[n],r=o.spec.tableRole;r&&(e[r]=o)}}return e}var U=new b("selectingCells");function Z(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function J(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function Y(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;const n=Z(e.$head)||function(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const o=e.type.spec.tableRole;if("cell"==o||"header_cell"==o)return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const o=e.type.spec.tableRole;if("cell"==o||"header_cell"==o)return t.doc.resolve(n-e.nodeSize)}}(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function Q(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function tt(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function et(t,e,n){const o=t.node(-1),r=X.get(o),s=t.start(-1),l=r.nextCell(t.pos-s,e,n);return null==l?null:t.node(0).resolve(s+l)}function nt(t,e,n=1){const o={...t,colspan:t.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(e,n),o.colwidth.some((t=>t>0))||(o.colwidth=null)),o}function ot(t,e,n=1){const o={...t,colspan:t.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let t=0;t<n;t++)o.colwidth.splice(e,0,0)}return o}var rt=class extends y{constructor(t,e=t){const n=t.node(-1),o=X.get(n),r=t.start(-1),s=o.rectBetween(t.pos-r,e.pos-r),l=t.node(0),a=o.cellsInRect(s).filter((t=>t!=e.pos-r));a.unshift(e.pos-r);const i=a.map((t=>{const e=n.nodeAt(t);if(!e)throw RangeError(`No cell with offset ${t} found`);const o=r+t+1;return new C(l.resolve(o),l.resolve(o+e.content.size))}));super(i[0].$from,i[0].$to,i),this.$anchorCell=t,this.$headCell=e}map(t,e){const n=t.resolve(e.map(this.$anchorCell.pos)),o=t.resolve(e.map(this.$headCell.pos));if(Q(n)&&Q(o)&&tt(n,o)){const t=this.$anchorCell.node(-1)!=n.node(-1);return t&&this.isRowSelection()?rt.rowSelection(n,o):t&&this.isColSelection()?rt.colSelection(n,o):new rt(n,o)}return v.between(n,o)}content(){const t=this.$anchorCell.node(-1),e=X.get(t),n=this.$anchorCell.start(-1),o=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),r={},s=[];for(let a=o.top;a<o.bottom;a++){const n=[];for(let s=a*e.width+o.left,l=o.left;l<o.right;l++,s++){const l=e.map[s];if(r[l])continue;r[l]=!0;const a=e.findCell(l);let i=t.nodeAt(l);if(!i)throw RangeError(`No cell with offset ${l} found`);const c=o.left-a.left,p=a.right-o.right;if(c>0||p>0){let t=i.attrs;if(c>0&&(t=nt(t,0,c)),p>0&&(t=nt(t,t.colspan-p,p)),a.left<o.left){if(i=i.type.createAndFill(t),!i)throw RangeError(`Could not create cell with attrs ${JSON.stringify(t)}`)}else i=i.type.create(t,i.content)}if(a.top<o.top||a.bottom>o.bottom){const t={...i.attrs,rowspan:Math.min(a.bottom,o.bottom)-Math.max(a.top,o.top)};i=a.top<o.top?i.type.createAndFill(t):i.type.create(t,i.content)}n.push(i)}s.push(t.child(a).copy(S.from(n)))}const l=this.isColSelection()&&this.isRowSelection()?t:s;return new $(S.from(l),1,1)}replace(t,e=$.empty){const n=t.steps.length,o=this.ranges;for(let s=0;s<o.length;s++){const{$from:r,$to:l}=o[s],a=t.mapping.slice(n);t.replace(a.map(r.pos),a.map(l.pos),s?$.empty:e)}const r=y.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);r&&t.setSelection(r)}replaceWith(t,e){this.replace(t,new $(S.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),n=X.get(e),o=this.$anchorCell.start(-1),r=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let s=0;s<r.length;s++)t(e.nodeAt(r[s]),o+r[s])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const n=t+this.$anchorCell.nodeAfter.attrs.rowspan,o=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,o)==this.$headCell.node(-1).childCount}static colSelection(t,e=t){const n=t.node(-1),o=X.get(n),r=t.start(-1),s=o.findCell(t.pos-r),l=o.findCell(e.pos-r),a=t.node(0);return s.top<=l.top?(s.top>0&&(t=a.resolve(r+o.map[s.left])),l.bottom<o.height&&(e=a.resolve(r+o.map[o.width*(o.height-1)+l.right-1]))):(l.top>0&&(e=a.resolve(r+o.map[l.left])),s.bottom<o.height&&(t=a.resolve(r+o.map[o.width*(o.height-1)+s.right-1]))),new rt(t,e)}isRowSelection(){const t=this.$anchorCell.node(-1),e=X.get(t),n=this.$anchorCell.start(-1),o=e.colCount(this.$anchorCell.pos-n),r=e.colCount(this.$headCell.pos-n);if(Math.min(o,r)>0)return!1;const s=o+this.$anchorCell.nodeAfter.attrs.colspan,l=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(s,l)==e.width}eq(t){return t instanceof rt&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,e=t){const n=t.node(-1),o=X.get(n),r=t.start(-1),s=o.findCell(t.pos-r),l=o.findCell(e.pos-r),a=t.node(0);return s.left<=l.left?(s.left>0&&(t=a.resolve(r+o.map[s.top*o.width])),l.right<o.width&&(e=a.resolve(r+o.map[o.width*(l.top+1)-1]))):(l.left>0&&(e=a.resolve(r+o.map[l.top*o.width])),s.right<o.width&&(t=a.resolve(r+o.map[o.width*(s.top+1)-1]))),new rt(t,e)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,e){return new rt(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){return new rt(t.resolve(e),t.resolve(n))}getBookmark(){return new st(this.$anchorCell.pos,this.$headCell.pos)}};rt.prototype.visible=!1,y.jsonID("cell",rt);var st=class{constructor(t,e){this.anchor=t,this.head=e}map(t){return new st(t.map(this.anchor),t.map(this.head))}resolve(t){const e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&tt(e,n)?new rt(e,n):y.near(n,1)}};function lt(t){if(!(t.selection instanceof rt))return null;const e=[];return t.selection.forEachCell(((t,n)=>{e.push(f.node(n,n+t.nodeSize,{class:"selectedCell"}))})),u.create(t.doc,e)}var at=new b("fix-tables");function it(t,e,n,o){const r=t.childCount,s=e.childCount;t:for(let l=0,a=0;l<s;l++){const s=e.child(l);for(let e=a,o=Math.min(r,l+3);e<o;e++)if(t.child(e)==s){a=e+1,n+=s.nodeSize;continue t}o(s,n),a<r&&t.child(a).sameMarkup(s)?it(t.child(a),s,n+1,o):s.nodesBetween(0,s.content.size,o,n+1),n+=s.nodeSize}}function ct(t,e){let n;const o=(e,o)=>{"table"==e.type.spec.tableRole&&(n=function(t,e,n,o){const r=X.get(e);if(!r.problems)return o;o||(o=t.tr);const s=[];for(let i=0;i<r.height;i++)s.push(0);for(let i=0;i<r.problems.length;i++){const t=r.problems[i];if("collision"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;const l=r.attrs;for(let e=0;e<l.rowspan;e++)s[t.row+e]+=t.n;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,nt(l,l.colspan-t.n,t.n))}else if("missing"==t.type)s[t.row]+=t.n;else if("overlong_rowspan"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,{...r.attrs,rowspan:r.attrs.rowspan-t.n})}else if("colwidth mismatch"==t.type){const r=e.nodeAt(t.pos);if(!r)continue;o.setNodeMarkup(o.mapping.map(n+1+t.pos),null,{...r.attrs,colwidth:t.colwidth})}}let l,a;for(let i=0;i<s.length;i++)s[i]&&(null==l&&(l=i),a=i);for(let i=0,c=n+1;i<r.height;i++){const n=e.child(i),r=c+n.nodeSize,p=s[i];if(p>0){let e="cell";n.firstChild&&(e=n.firstChild.type.spec.tableRole);const s=[];for(let n=0;n<p;n++){const n=G(t.schema)[e].createAndFill();n&&s.push(n)}const d=0!=i&&l!=i-1||a!=i?r-1:c+1;o.insert(o.mapping.map(d),s)}c=r}return o.setMeta(at,{fixTables:!0})}(t,e,o,n))};return e?e.doc!=t.doc&&it(e.doc,t.doc,0,o):t.doc.descendants(o),n}function pt(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:o}=t;for(;1==e.childCount&&(n>0&&o>0||"table"==e.child(0).type.spec.tableRole);)n--,o--,e=e.child(0).content;const r=e.child(0),s=r.type.spec.tableRole,l=r.type.schema,a=[];if("row"==s)for(let i=0;i<e.childCount;i++){let t=e.child(i).content;const r=i?0:Math.max(0,n-1),s=i<e.childCount-1?0:Math.max(0,o-1);(r||s)&&(t=dt(G(l).row,new $(t,r,s)).content),a.push(t)}else{if("cell"!=s&&"header_cell"!=s)return null;a.push(n||o?dt(G(l).row,new $(e,n,o)).content:e)}return function(t,e){const n=[];for(let r=0;r<e.length;r++){const t=e[r];for(let e=t.childCount-1;e>=0;e--){const{rowspan:o,colspan:s}=t.child(e).attrs;for(let t=r;t<r+o;t++)n[t]=(n[t]||0)+s}}let o=0;for(let r=0;r<n.length;r++)o=Math.max(o,n[r]);for(let r=0;r<n.length;r++)if(r>=e.length&&e.push(S.empty),n[r]<o){const s=G(t).cell.createAndFill(),l=[];for(let t=n[r];t<o;t++)l.push(s);e[r]=e[r].append(S.from(l))}return{height:e.length,width:o,rows:e}}(l,a)}function dt(t,e){const n=t.createAndFill();return new R(n).replace(0,n.content.size,e).doc}function ht(t,e,n,o,r,s,l,a){if(0==l||l==e.height)return!1;let i=!1;for(let c=r;c<s;c++){const r=l*e.width+c,s=e.map[r];if(e.map[r-e.width]==s){i=!0;const r=n.nodeAt(s),{top:p,left:d}=e.findCell(s);t.setNodeMarkup(t.mapping.slice(a).map(s+o),null,{...r.attrs,rowspan:l-p}),t.insert(t.mapping.slice(a).map(e.positionAt(l,d,n)),r.type.createAndFill({...r.attrs,rowspan:p+r.attrs.rowspan-l})),c+=r.attrs.colspan-1}}return i}function ut(t,e,n,o,r,s,l,a){if(0==l||l==e.width)return!1;let i=!1;for(let c=r;c<s;c++){const r=c*e.width+l,s=e.map[r];if(e.map[r-1]==s){i=!0;const r=n.nodeAt(s),p=e.colCount(s),d=t.mapping.slice(a).map(s+o);t.setNodeMarkup(d,null,nt(r.attrs,l-p,r.attrs.colspan-(l-p))),t.insert(d+r.nodeSize,r.type.createAndFill(nt(r.attrs,0,l-p))),c+=r.attrs.rowspan-1}}return i}function ft(t,e,n,o,r){let s=n?t.doc.nodeAt(n-1):t.doc;if(!s)throw new Error("No table found");let l=X.get(s);const{top:a,left:i}=o,c=i+r.width,p=a+r.height,d=t.tr;let h=0;function u(){if(s=n?d.doc.nodeAt(n-1):d.doc,!s)throw new Error("No table found");l=X.get(s),h=d.mapping.maps.length}(function(t,e,n,o,r,s,l){const a=G(t.doc.type.schema);let i,c;if(r>e.width)for(let p=0,d=0;p<e.height;p++){const s=n.child(p);d+=s.nodeSize;const h=[];let u;u=null==s.lastChild||s.lastChild.type==a.cell?i||(i=a.cell.createAndFill()):c||(c=a.header_cell.createAndFill());for(let t=e.width;t<r;t++)h.push(u);t.insert(t.mapping.slice(l).map(d-1+o),h)}if(s>e.height){const p=[];for(let t=0,o=(e.height-1)*e.width;t<Math.max(e.width,r);t++){const r=!(t>=e.width)&&n.nodeAt(e.map[o+t]).type==a.header_cell;p.push(r?c||(c=a.header_cell.createAndFill()):i||(i=a.cell.createAndFill()))}const d=a.row.create(null,S.from(p)),h=[];for(let t=e.height;t<s;t++)h.push(d);t.insert(t.mapping.slice(l).map(o+n.nodeSize-2),h)}return!(!i&&!c)})(d,l,s,n,c,p,h)&&u(),ht(d,l,s,n,i,c,a,h)&&u(),ht(d,l,s,n,i,c,p,h)&&u(),ut(d,l,s,n,a,p,i,h)&&u(),ut(d,l,s,n,a,p,c,h)&&u();for(let f=a;f<p;f++){const t=l.positionAt(f,i,s),e=l.positionAt(f,c,s);d.replace(d.mapping.slice(h).map(t+n),d.mapping.slice(h).map(e+n),new $(r.rows[f-a],0,0))}u(),d.setSelection(new rt(d.doc.resolve(n+l.positionAt(a,i,s)),d.doc.resolve(n+l.positionAt(p-1,c-1,s)))),e(d)}var mt=k({ArrowLeft:wt("horiz",-1),ArrowRight:wt("horiz",1),ArrowUp:wt("vert",-1),ArrowDown:wt("vert",1),"Shift-ArrowLeft":bt("horiz",-1),"Shift-ArrowRight":bt("horiz",1),"Shift-ArrowUp":bt("vert",-1),"Shift-ArrowDown":bt("vert",1),Backspace:yt,"Mod-Backspace":yt,Delete:yt,"Mod-Delete":yt});function gt(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function wt(t,e){return(n,o,r)=>{if(!r)return!1;const s=n.selection;if(s instanceof rt)return gt(n,o,y.near(s.$headCell,e));if("horiz"!=t&&!s.empty)return!1;const l=Mt(r,t,e);if(null==l)return!1;if("horiz"==t)return gt(n,o,y.near(n.doc.resolve(s.head+e),e));{const r=n.doc.resolve(l),s=et(r,t,e);let a;return a=s?y.near(s,1):e<0?y.near(n.doc.resolve(r.before(-1)),-1):y.near(n.doc.resolve(r.after(-1)),1),gt(n,o,a)}}}function bt(t,e){return(n,o,r)=>{if(!r)return!1;const s=n.selection;let l;if(s instanceof rt)l=s;else{const o=Mt(r,t,e);if(null==o)return!1;l=new rt(n.doc.resolve(o))}const a=et(l.$headCell,t,e);return!!a&&gt(n,o,new rt(l.$anchorCell,a))}}function yt(t,e){const n=t.selection;if(!(n instanceof rt))return!1;if(e){const o=t.tr,r=G(t.schema).cell.createAndFill().content;n.forEachCell(((t,e)=>{t.content.eq(r)||o.replace(o.mapping.map(e+1),o.mapping.map(e+t.nodeSize-1),new $(r,0,0))})),o.docChanged&&e(o)}return!0}function Ct(t,e){const n=Z(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new rt(n))),!0)}function vt(t,e,n){if(!J(t.state))return!1;let o=pt(n);const r=t.state.selection;if(r instanceof rt){o||(o={width:1,height:1,rows:[S.from(dt(G(t.state.schema).cell,n))]});const e=r.$anchorCell.node(-1),s=r.$anchorCell.start(-1),l=X.get(e).rectBetween(r.$anchorCell.pos-s,r.$headCell.pos-s);return o=function({width:t,height:e,rows:n},o,r){if(t!=o){const e=[],r=[];for(let t=0;t<n.length;t++){const s=n[t],l=[];for(let n=e[t]||0,r=0;n<o;r++){let a=s.child(r%s.childCount);n+a.attrs.colspan>o&&(a=a.type.createChecked(nt(a.attrs,a.attrs.colspan,n+a.attrs.colspan-o),a.content)),l.push(a),n+=a.attrs.colspan;for(let n=1;n<a.attrs.rowspan;n++)e[t+n]=(e[t+n]||0)+a.attrs.colspan}r.push(S.from(l))}n=r,t=o}if(e!=r){const t=[];for(let o=0,s=0;o<r;o++,s++){const l=[],a=n[s%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);o+e.attrs.rowspan>r&&(e=e.type.create({...e.attrs,rowspan:Math.max(1,r-e.attrs.rowspan)},e.content)),l.push(e)}t.push(S.from(l))}n=t,e=r}return{width:t,height:e,rows:n}}(o,l.right-l.left,l.bottom-l.top),ft(t.state,t.dispatch,s,l,o),!0}if(o){const e=Y(t.state),n=e.start(-1);return ft(t.state,t.dispatch,n,X.get(e.node(-1)).findCell(e.pos-n),o),!0}return!1}function At(t,e){var n;if(e.ctrlKey||e.metaKey)return;const o=St(t,e.target);let r;if(e.shiftKey&&t.state.selection instanceof rt)s(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&null!=(r=Z(t.state.selection.$anchor))&&(null==(n=$t(t,e))?void 0:n.pos)!=r.pos)s(r,e),e.preventDefault();else if(!o)return;function s(e,n){let o=$t(t,n);const r=null==U.getState(t.state);if(!o||!tt(e,o)){if(!r)return;o=e}const s=new rt(e,o);if(r||!t.state.selection.eq(s)){const n=t.state.tr.setSelection(s);r&&n.setMeta(U,e.pos),t.dispatch(n)}}function l(){t.root.removeEventListener("mouseup",l),t.root.removeEventListener("dragstart",l),t.root.removeEventListener("mousemove",a),null!=U.getState(t.state)&&t.dispatch(t.state.tr.setMeta(U,-1))}function a(n){const r=n,a=U.getState(t.state);let i;if(null!=a)i=t.state.doc.resolve(a);else if(St(t,r.target)!=o&&(i=$t(t,e),!i))return l();i&&s(i,r)}t.root.addEventListener("mouseup",l),t.root.addEventListener("dragstart",l),t.root.addEventListener("mousemove",a)}function Mt(t,e,n){if(!(t.state.selection instanceof v))return null;const{$head:o}=t.state.selection;for(let r=o.depth-1;r>=0;r--){const s=o.node(r);if((n<0?o.index(r):o.indexAfter(r))!=(n<0?0:s.childCount))return null;if("cell"==s.type.spec.tableRole||"header_cell"==s.type.spec.tableRole){const s=o.before(r),l="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(l)?s:null}}return null}function St(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function $t(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?Z(t.state.doc.resolve(n.pos)):null}var kt=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Rt(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,Rt(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}};function Rt(t,e,n,o,r,s){var l;let a=0,i=!0,c=e.firstChild;const p=t.firstChild;if(p){for(let t=0,n=0;t<p.childCount;t++){const{colspan:l,colwidth:d}=p.child(t).attrs;for(let t=0;t<l;t++,n++){const l=r==n?s:d&&d[t],p=l?l+"px":"";a+=l||o,l||(i=!1),c?(c.style.width!=p&&(c.style.width=p),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=p}}for(;c;){const t=c.nextSibling;null==(l=c.parentNode)||l.removeChild(c),c=t}i?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var Dt=new b("tableColumnResizing");function _t({handleWidth:t=5,cellMinWidth:e=25,View:n=kt,lastColumnResizable:o=!0}={}){const r=new A({key:Dt,state:{init:(t,o)=>(r.spec.props.nodeViews[G(o.schema).table.name]=(t,o)=>new n(t,e,o),new xt(-1,!1)),apply:(t,e)=>e.apply(t)},props:{attributes:t=>{const e=Dt.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(e,n)=>{!function(t,e,n,o,r){const s=Dt.getState(t.state);if(!s)return;if(!s.dragging){const o=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let l=-1;if(o){const{left:r,right:s}=o.getBoundingClientRect();e.clientX-r<=n?l=Ot(t,e,"left",n):s-e.clientX<=n&&(l=Ot(t,e,"right",n))}if(l!=s.activeHandle){if(!r&&-1!==l){const e=t.state.doc.resolve(l),n=e.node(-1),o=X.get(n),r=e.start(-1);if(o.colCount(e.pos-r)+e.nodeAfter.attrs.colspan-1==o.width-1)return}zt(t,l)}}}(e,n,t,0,o)},mouseleave:t=>{!function(t){const e=Dt.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&zt(t,-1)}(t)},mousedown:(t,n)=>{!function(t,e,n){const o=Dt.getState(t.state);if(!o||-1==o.activeHandle||o.dragging)return!1;const r=t.state.doc.nodeAt(o.activeHandle),s=function(t,e,{colspan:n,colwidth:o}){const r=o&&o[o.length-1];if(r)return r;const s=t.domAtPos(e);let l=s.node.childNodes[s.offset].offsetWidth,a=n;if(o)for(let i=0;i<n;i++)o[i]&&(l-=o[i],a--);return l/a}(t,o.activeHandle,r.attrs);function l(e){window.removeEventListener("mouseup",l),window.removeEventListener("mousemove",a);const o=Dt.getState(t.state);(null==o?void 0:o.dragging)&&(!function(t,e,n){const o=t.state.doc.resolve(e),r=o.node(-1),s=X.get(r),l=o.start(-1),a=s.colCount(o.pos-l)+o.nodeAfter.attrs.colspan-1,i=t.state.tr;for(let c=0;c<s.height;c++){const t=c*s.width+a;if(c&&s.map[t]==s.map[t-s.width])continue;const e=s.map[t],o=r.nodeAt(e).attrs,p=1==o.colspan?0:a-s.colCount(e);if(o.colwidth&&o.colwidth[p]==n)continue;const d=o.colwidth?o.colwidth.slice():Et(o.colspan);d[p]=n,i.setNodeMarkup(l+e,null,{...o,colwidth:d})}i.docChanged&&t.dispatch(i)}(t,o.activeHandle,Nt(o.dragging,e,n)),t.dispatch(t.state.tr.setMeta(Dt,{setDragging:null})))}function a(e){if(!e.which)return l(e);const o=Dt.getState(t.state);if(o&&o.dragging){const r=Nt(o.dragging,e,n);!function(t,e,n,o){const r=t.state.doc.resolve(e),s=r.node(-1),l=r.start(-1),a=X.get(s).colCount(r.pos-l)+r.nodeAfter.attrs.colspan-1;let i=t.domAtPos(r.start(-1)).node;for(;i&&"TABLE"!=i.nodeName;)i=i.parentNode;if(!i)return;Rt(s,i.firstChild,i,o,a,n)}(t,o.activeHandle,r,n)}}t.dispatch(t.state.tr.setMeta(Dt,{setDragging:{startX:e.clientX,startWidth:s}})),window.addEventListener("mouseup",l),window.addEventListener("mousemove",a),e.preventDefault()}(t,n,e)}},decorations:t=>{const e=Dt.getState(t);if(e&&e.activeHandle>-1)return function(t,e){const n=[],o=t.doc.resolve(e),r=o.node(-1);if(!r)return u.empty;const s=X.get(r),l=o.start(-1),a=s.colCount(o.pos-l)+o.nodeAfter.attrs.colspan;for(let i=0;i<s.height;i++){const t=a+i*s.width-1;if(!(a!=s.width&&s.map[t]==s.map[t+1]||0!=i&&s.map[t]==s.map[t-s.width])){const e=s.map[t],o=l+e+r.nodeAt(e).nodeSize-1,a=document.createElement("div");a.className="column-resize-handle",n.push(f.widget(o,a))}}return u.create(t.doc,n)}(t,e.activeHandle)},nodeViews:{}}});return r}var xt=class{constructor(t,e){this.activeHandle=t,this.dragging=e}apply(t){const e=this,n=t.getMeta(Dt);if(n&&null!=n.setHandle)return new xt(n.setHandle,!1);if(n&&void 0!==n.setDragging)return new xt(e.activeHandle,n.setDragging);if(e.activeHandle>-1&&t.docChanged){let n=t.mapping.map(e.activeHandle,-1);return Q(t.doc.resolve(n))||(n=-1),new xt(n,e.dragging)}return e}};function Ot(t,e,n,o){const r="right"==n?-o:o,s=t.posAtCoords({left:e.clientX+r,top:e.clientY});if(!s)return-1;const{pos:l}=s,a=Z(t.state.doc.resolve(l));if(!a)return-1;if("right"==n)return a.pos;const i=X.get(a.node(-1)),c=a.start(-1),p=i.map.indexOf(a.pos-c);return p%i.width==0?-1:c+i.map[p-1]}function Nt(t,e,n){const o=e.clientX-t.startX;return Math.max(n,t.startWidth+o)}function zt(t,e){t.dispatch(t.state.tr.setMeta(Dt,{setHandle:e}))}function Et(t){return Array(t).fill(0)}function Tt(t){const e=t.selection,n=Y(t),o=n.node(-1),r=n.start(-1),s=X.get(o);return{...e instanceof rt?s.rectBetween(e.$anchorCell.pos-r,e.$headCell.pos-r):s.findCell(n.pos-r),tableStart:r,map:s,table:o}}function Ht(t,{map:e,tableStart:n,table:o},r){let s=r>0?-1:0;(function(t,e,n){const o=G(e.type.schema).header_cell;for(let r=0;r<t.height;r++)if(e.nodeAt(t.map[n+r*t.width]).type!=o)return!1;return!0})(e,o,r+s)&&(s=0==r||r==e.width?null:0);for(let l=0;l<e.height;l++){const a=l*e.width+r;if(r>0&&r<e.width&&e.map[a-1]==e.map[a]){const s=e.map[a],i=o.nodeAt(s);t.setNodeMarkup(t.mapping.map(n+s),null,ot(i.attrs,r-e.colCount(s))),l+=i.attrs.rowspan-1}else{const i=null==s?G(o.type.schema).cell:o.nodeAt(e.map[a+s]).type,c=e.positionAt(l,r,o);t.insert(t.mapping.map(n+c),i.createAndFill())}}return t}function Lt(t,e){if(!J(t))return!1;if(e){const n=Tt(t);e(Ht(t.tr,n,n.left))}return!0}function Wt(t,e){if(!J(t))return!1;if(e){const n=Tt(t);e(Ht(t.tr,n,n.right))}return!0}function jt(t,{map:e,table:n,tableStart:o},r){const s=t.mapping.maps.length;for(let l=0;l<e.height;){const a=l*e.width+r,i=e.map[a],c=n.nodeAt(i),p=c.attrs;if(r>0&&e.map[a-1]==i||r<e.width-1&&e.map[a+1]==i)t.setNodeMarkup(t.mapping.slice(s).map(o+i),null,nt(p,r-e.colCount(i)));else{const e=t.mapping.slice(s).map(o+i);t.delete(e,e+c.nodeSize)}l+=p.rowspan}}function Ft(t,e){if(!J(t))return!1;if(e){const n=Tt(t),o=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(let t=n.right-1;jt(o,n,t),t!=n.left;t--){const t=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!t)throw RangeError("No table found");n.table=t,n.map=X.get(t)}e(o)}return!0}function Bt(t,{map:e,tableStart:n,table:o},r){var s;let l=n;for(let c=0;c<r;c++)l+=o.child(c).nodeSize;const a=[];let i=r>0?-1:0;(function(t,e,n){var o;const r=G(e.type.schema).header_cell;for(let s=0;s<t.width;s++)if((null==(o=e.nodeAt(t.map[s+n*t.width]))?void 0:o.type)!=r)return!1;return!0})(e,o,r+i)&&(i=0==r||r==e.height?null:0);for(let c=0,p=e.width*r;c<e.width;c++,p++)if(r>0&&r<e.height&&e.map[p]==e.map[p-e.width]){const r=e.map[p],s=o.nodeAt(r).attrs;t.setNodeMarkup(n+r,null,{...s,rowspan:s.rowspan+1}),c+=s.colspan-1}else{const t=null==i?G(o.type.schema).cell:null==(s=o.nodeAt(e.map[p+i*e.width]))?void 0:s.type,n=null==t?void 0:t.createAndFill();n&&a.push(n)}return t.insert(l,G(o.type.schema).row.create(null,a)),t}function It(t,e){if(!J(t))return!1;if(e){const n=Tt(t);e(Bt(t.tr,n,n.top))}return!0}function Vt(t,e){if(!J(t))return!1;if(e){const n=Tt(t);e(Bt(t.tr,n,n.bottom))}return!0}function Xt(t,{map:e,table:n,tableStart:o},r){let s=0;for(let i=0;i<r;i++)s+=n.child(i).nodeSize;const l=s+n.child(r).nodeSize,a=t.mapping.maps.length;t.delete(s+o,l+o);for(let i=0,c=r*e.width;i<e.width;i++,c++){const s=e.map[c];if(r>0&&s==e.map[c-e.width]){const e=n.nodeAt(s).attrs;t.setNodeMarkup(t.mapping.slice(a).map(s+o),null,{...e,rowspan:e.rowspan-1}),i+=e.colspan-1}else if(r<e.width&&s==e.map[c+e.width]){const l=n.nodeAt(s),c=l.attrs,p=l.type.create({...c,rowspan:l.attrs.rowspan-1},l.content),d=e.positionAt(r+1,i,n);t.insert(t.mapping.slice(a).map(o+d),p),i+=c.colspan-1}}}function qt(t,e){if(!J(t))return!1;if(e){const n=Tt(t),o=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(let t=n.bottom-1;Xt(o,n,t),t!=n.top;t--){const t=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!t)throw RangeError("No table found");n.table=t,n.map=X.get(n.table)}e(o)}return!0}function Pt(t){const e=t.content;return 1==e.childCount&&e.child(0).isTextblock&&0==e.child(0).childCount}function Kt(t,e){const n=t.selection;if(!(n instanceof rt)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=Tt(t),{map:r}=o;if(function({width:t,height:e,map:n},o){let r=o.top*t+o.left,s=r,l=(o.bottom-1)*t+o.left,a=r+(o.right-o.left-1);for(let i=o.top;i<o.bottom;i++){if(o.left>0&&n[s]==n[s-1]||o.right<t&&n[a]==n[a+1])return!0;s+=t,a+=t}for(let i=o.left;i<o.right;i++){if(o.top>0&&n[r]==n[r-t]||o.bottom<e&&n[l]==n[l+t])return!0;r++,l++}return!1}(r,o))return!1;if(e){const n=t.tr,s={};let l,a,i=S.empty;for(let t=o.top;t<o.bottom;t++)for(let e=o.left;e<o.right;e++){const c=r.map[t*r.width+e],p=o.table.nodeAt(c);if(!s[c]&&p)if(s[c]=!0,null==l)l=c,a=p;else{Pt(p)||(i=i.append(p.content));const t=n.mapping.map(c+o.tableStart);n.delete(t,t+p.nodeSize)}}if(null==l||null==a)return!0;if(n.setNodeMarkup(l+o.tableStart,null,{...ot(a.attrs,a.attrs.colspan,o.right-o.left-a.attrs.colspan),rowspan:o.bottom-o.top}),i.size){const t=l+1+a.content.size,e=Pt(a)?l+1:t;n.replaceWith(e+o.tableStart,t+o.tableStart,i)}n.setSelection(new rt(n.doc.resolve(l+o.tableStart))),e(n)}return!0}function Gt(t,e){const n=G(t.schema);return(o=({node:t})=>n[t.type.spec.tableRole],(t,e)=>{var n;const r=t.selection;let s,l;if(r instanceof rt){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,l=r.$anchorCell.pos}else{if(s=function(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if("cell"===n||"header_cell"===n)return t.node(e)}return null}(r.$from),!s)return!1;l=null==(n=Z(r.$from))?void 0:n.pos}if(null==s||null==l)return!1;if(1==s.attrs.colspan&&1==s.attrs.rowspan)return!1;if(e){let n=s.attrs;const a=[],i=n.colwidth;n.rowspan>1&&(n={...n,rowspan:1}),n.colspan>1&&(n={...n,colspan:1});const c=Tt(t),p=t.tr;for(let t=0;t<c.right-c.left;t++)a.push(i?{...n,colwidth:i&&i[t]?[i[t]]:null}:n);let d;for(let t=c.top;t<c.bottom;t++){let e=c.map.positionAt(t,c.left,c.table);t==c.top&&(e+=s.nodeSize);for(let n=c.left,r=0;n<c.right;n++,r++)n==c.left&&t==c.top||p.insert(d=p.mapping.map(e+c.tableStart,1),o({node:s,row:t,col:n}).createAndFill(a[r]))}p.setNodeMarkup(l,o({node:s,row:c.top,col:c.left}),a[0]),r instanceof rt&&p.setSelection(new rt(p.doc.resolve(r.$anchorCell.pos),d?p.doc.resolve(d):void 0)),e(p)}return!0})(t,e);var o}function Ut(t,e,n){const o=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1});for(let r=0;r<o.length;r++){const t=e.table.nodeAt(o[r]);if(t&&t.type!==n.header_cell)return!1}return!0}function Zt(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,n){if(!J(e))return!1;if(n){const o=G(e.schema),r=Tt(e),s=e.tr,l=r.map.cellsInRect("column"==t?{left:r.left,top:0,right:r.right,bottom:r.map.height}:"row"==t?{left:0,top:r.top,right:r.map.width,bottom:r.bottom}:r),a=l.map((t=>r.table.nodeAt(t)));for(let t=0;t<l.length;t++)a[t].type==o.header_cell&&s.setNodeMarkup(r.tableStart+l[t],o.cell,a[t].attrs);if(0==s.steps.length)for(let t=0;t<l.length;t++)s.setNodeMarkup(r.tableStart+l[t],o.header_cell,a[t].attrs);n(s)}return!0}}(t):function(e,n){if(!J(e))return!1;if(n){const o=G(e.schema),r=Tt(e),s=e.tr,l=Ut("row",r,o),a=Ut("column",r,o),i=("column"===t?l:"row"===t&&a)?1:0,c="column"==t?{left:0,top:i,right:1,bottom:r.map.height}:"row"==t?{left:i,top:0,right:r.map.width,bottom:1}:r,p="column"==t?a?o.cell:o.header_cell:"row"==t?l?o.cell:o.header_cell:o.cell;r.map.cellsInRect(c).forEach((t=>{const e=t+r.tableStart,n=s.doc.nodeAt(e);n&&s.setNodeMarkup(e,p,n.attrs)})),n(s)}return!0}}var Jt=Zt("row",{useDeprecatedLogic:!0}),Yt=Zt("column",{useDeprecatedLogic:!0}),Qt=Zt("cell",{useDeprecatedLogic:!0});function te(t){return function(e,n){if(!J(e))return!1;const o=function(t,e){if(e<0){const e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let n=t.index(-1)-1,o=t.before();n>=0;n--){const e=t.node(-1).child(n),r=e.lastChild;if(r)return o-1-r.nodeSize;o-=e.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const e=t.node(-1);for(let n=t.indexAfter(-1),o=t.after();n<e.childCount;n++){const t=e.child(n);if(t.childCount)return o+1;o+=t.nodeSize}}return null}(Y(e),t);if(null==o)return!1;if(n){const t=e.doc.resolve(o);n(e.tr.setSelection(v.between(t,(r=t,r.node(0).resolve(r.pos+r.nodeAfter.nodeSize)))).scrollIntoView())}var r;return!0}}function ee(t,e){const n=t.selection.$anchor;for(let o=n.depth;o>0;o--){if("table"==n.node(o).type.spec.tableRole)return e&&e(t.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0}return!1}function ne({allowTableNodeSelection:t=!1}={}){return new A({key:U,state:{init:()=>null,apply(t,e){const n=t.getMeta(U);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;const{deleted:o,pos:r}=t.mapping.mapResult(e);return o?null:r}},props:{decorations:lt,handleDOMEvents:{mousedown:At},createSelectionBetween:t=>null!=U.getState(t.state)?t.state.selection:null,handleTripleClick:Ct,handleKeyDown:mt,handlePaste:vt},appendTransaction:(e,n,o)=>function(t,e,n){const o=(e||t).selection,r=(e||t).doc;let s,l;if(o instanceof M&&(l=o.node.type.spec.tableRole)){if("cell"==l||"header_cell"==l)s=rt.create(r,o.from);else if("row"==l){const t=r.resolve(o.from+1);s=rt.rowSelection(t,t)}else if(!n){const t=X.get(o.node),e=o.from+1,n=e+t.map[t.width*t.height-1];s=rt.create(r,e+1,n)}}else o instanceof v&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,o=e.pos,r=t.depth;for(;r>=0&&!(t.after(r+1)<t.end(r));r--,n++);for(let s=e.depth;s>=0&&!(e.before(s+1)>e.start(s));s--,o--);return n==o&&/row|table/.test(t.node(r).type.spec.tableRole)}(o)?s=v.create(r,o.from):o instanceof v&&function({$from:t,$to:e}){let n,o;for(let r=t.depth;r>0;r--){const e=t.node(r);if("cell"===e.type.spec.tableRole||"header_cell"===e.type.spec.tableRole){n=e;break}}for(let r=e.depth;r>0;r--){const t=e.node(r);if("cell"===t.type.spec.tableRole||"header_cell"===t.type.spec.tableRole){o=t;break}}return n!==o&&0===e.parentOffset}(o)&&(s=v.create(r,o.$from.start(),o.$from.end()));return s&&(e||(e=t.tr)).setSelection(s),e}(o,ct(o,n),t)})}class oe extends t{get name(){return"blockquote"}get schema(){return{content:"block*",group:"block",defining:!0,draggable:!1,parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]}}commands({type:t}){return()=>o(t)}keys({type:t}){return{"Ctrl->":o(t)}}inputRules({type:t}){return[z(/^\s*>\s$/,t)]}}class re extends t{get name(){return"bullet_list"}get schema(){return{content:"list_item+",group:"block",parseDOM:[{tag:"ul"}],toDOM:()=>["ul",0]}}commands({type:t,schema:e}){return()=>r(t,e.nodes.list_item)}keys({type:t,schema:e}){return{"Shift-Ctrl-8":r(t,e.nodes.list_item)}}inputRules({type:t}){return[z(/^\s*([-+*])\s$/,t)]}}class se extends t{get name(){return"code_block"}get schema(){return{content:"text*",marks:"",group:"block",code:!0,defining:!0,draggable:!1,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:()=>["pre",["code",0]]}}commands({type:t,schema:e}){return()=>s(t,e.nodes.paragraph)}keys({type:t}){return{"Shift-Ctrl-\\":T(t)}}inputRules({type:t}){return[E(/^```$/,t)]}}class le extends t{get name(){return"hard_break"}get schema(){return{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}}commands({type:t}){return()=>L(W,((e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)))}keys({type:t}){const e=L(W,((e,n)=>(n(e.tr.replaceSelectionWith(t.create()).scrollIntoView()),!0)));return{"Mod-Enter":e,"Shift-Enter":e}}}class ae extends t{get name(){return"heading"}get defaultOptions(){return{levels:[1,2,3,4,5,6]}}get schema(){return{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,draggable:!1,parseDOM:this.options.levels.map((t=>({tag:`h${t}`,attrs:{level:t}}))),toDOM:t=>[`h${t.attrs.level}`,0]}}commands({type:t,schema:e}){return n=>s(t,e.nodes.paragraph,n)}keys({type:t}){return this.options.levels.reduce(((e,n)=>({...e,[`Shift-Ctrl-${n}`]:T(t,{level:n})})),{})}inputRules({type:t}){return this.options.levels.map((e=>E(new RegExp(`^(#{1,${e}})\\s$`),t,(()=>({level:e})))))}}class ie extends t{get name(){return"horizontal_rule"}get schema(){return{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["hr"]}}commands({type:t}){return()=>(e,n)=>n(e.tr.replaceSelectionWith(t.create()))}inputRules({type:t}){return[l(/^(?:---|___\s|\*\*\*\s)$/,t)]}}const ce=/!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\)/;class pe extends t{get name(){return"image"}get schema(){return{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:t=>({src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")})}],toDOM:t=>["img",t.attrs]}}commands({type:t}){return e=>(n,o)=>{const{selection:r}=n,s=r.$cursor?r.$cursor.pos:r.$to.pos,l=t.create(e);o(n.tr.insert(s,l))}}inputRules({type:t}){return[l(ce,t,(t=>{const[,e,n,o]=t;return{src:n,alt:e,title:o}}))]}get plugins(){return[new A({props:{handleDOMEvents:{drop(t,e){if(!(e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length))return;const n=Array.from(e.dataTransfer.files).filter((t=>/image/i.test(t.type)));if(0===n.length)return;e.preventDefault();const{schema:o}=t.state,r=t.posAtCoords({left:e.clientX,top:e.clientY});n.forEach((e=>{const n=new FileReader;n.onload=e=>{const n=o.nodes.image.create({src:e.target.result}),s=t.state.tr.insert(r.pos,n);t.dispatch(s)},n.readAsDataURL(e)}))}}}})]}}class de extends t{get name(){return"list_item"}get schema(){return{content:"paragraph block*",defining:!0,draggable:!1,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]}}keys({type:t}){return{Enter:j(t),Tab:F(t),"Shift-Tab":B(t)}}}class he extends t{get name(){return"ordered_list"}get schema(){return{attrs:{order:{default:1}},content:"list_item+",group:"block",parseDOM:[{tag:"ol",getAttrs:t=>({order:t.hasAttribute("start")?+t.getAttribute("start"):1})}],toDOM:t=>1===t.attrs.order?["ol",0]:["ol",{start:t.attrs.order},0]}}commands({type:t,schema:e}){return()=>r(t,e.nodes.list_item)}keys({type:t,schema:e}){return{"Shift-Ctrl-9":r(t,e.nodes.list_item)}}inputRules({type:t}){return[z(/^(\d+)\.\s$/,t,(t=>({order:+t[1]})),((t,e)=>e.childCount+e.attrs.order===+t[1]))]}}var ue=function(t){const e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(const o in e)n[o]={default:e[o].default};return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:()=>["table",["tbody",0]]},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},table_cell:{content:t.cellContent,attrs:n,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:t=>P(t,e)}],toDOM:t=>["td",K(t,e),0]},table_header:{content:t.cellContent,attrs:n,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:t=>P(t,e)}],toDOM:t=>["th",K(t,e),0]}}}({tableGroup:"block",cellContent:"block+",cellAttributes:{background:{default:null,getFromDOM:t=>t.style.backgroundColor||null,setDOMAttr(t,e){if(t){const n={style:`${e.style||""}background-color: ${t};`};Object.assign(e,n)}}}}});class fe extends t{get name(){return"table"}get defaultOptions(){return{resizable:!1}}get schema(){return ue.table}commands({schema:t}){return{createTable:({rowsCount:e,colsCount:n,withHeaderRow:o})=>(r,s)=>{const l=r.tr.selection.anchor+1,a=m(t,e,n,o),i=r.tr.replaceSelectionWith(a).scrollIntoView(),c=i.doc.resolve(l);i.setSelection(v.near(c)),s(i)},addColumnBefore:()=>Lt,addColumnAfter:()=>Wt,deleteColumn:()=>Ft,addRowBefore:()=>It,addRowAfter:()=>Vt,deleteRow:()=>qt,deleteTable:()=>ee,toggleCellMerge:()=>(t,e)=>{Kt(t,e)||Gt(t,e)},mergeCells:()=>Kt,splitCell:()=>Gt,toggleHeaderColumn:()=>Yt,toggleHeaderRow:()=>Jt,toggleHeaderCell:()=>Qt,setCellAttr:({name:t,value:e})=>function(t,e){return function(n,o){if(!J(n))return!1;const r=Y(n);if(r.nodeAfter.attrs[t]===e)return!1;if(o){const s=n.tr;n.selection instanceof rt?n.selection.forEachCell(((n,o)=>{n.attrs[t]!==e&&s.setNodeMarkup(o,null,{...n.attrs,[t]:e})})):s.setNodeMarkup(r.pos,null,{...r.nodeAfter.attrs,[t]:e}),o(s)}return!0}}(t,e),fixTables:()=>ct}}keys(){return{Tab:te(1),"Shift-Tab":te(-1)}}get plugins(){return[...this.options.resizable?[_t()]:[],ne()]}}class me extends t{get name(){return"table_header"}get schema(){return ue.table_header}}class ge extends t{get name(){return"table_cell"}get schema(){return ue.table_cell}}class we extends t{get name(){return"table_row"}get schema(){return ue.table_row}}class be extends t{get name(){return"todo_item"}get defaultOptions(){return{nested:!1}}get view(){return{props:["node","updateAttrs","view"],methods:{onChange(){this.updateAttrs({done:!this.node.attrs.done})}},template:'\n        <li :data-type="node.type.name" :data-done="node.attrs.done.toString()" data-drag-handle>\n          <span class="todo-checkbox" contenteditable="false" @click="onChange"></span>\n          <div class="todo-content" ref="content" :contenteditable="view.editable.toString()"></div>\n        </li>\n      '}}get schema(){return{attrs:{done:{default:!1}},draggable:!0,content:this.options.nested?"(paragraph|todo_list)+":"paragraph+",toDOM:t=>{const{done:e}=t.attrs;return["li",{"data-type":this.name,"data-done":e.toString()},["span",{class:"todo-checkbox",contenteditable:"false"}],["div",{class:"todo-content"},0]]},parseDOM:[{priority:51,tag:`[data-type="${this.name}"]`,getAttrs:t=>({done:"true"===t.getAttribute("data-done")})}]}}keys({type:t}){return{Enter:a(t),Tab:this.options.nested?F(t):()=>{},"Shift-Tab":B(t)}}}class ye extends t{get name(){return"todo_list"}get schema(){return{group:"block",content:"todo_item+",toDOM:()=>["ul",{"data-type":this.name},0],parseDOM:[{priority:51,tag:`[data-type="${this.name}"]`}]}}commands({type:t,schema:e}){return()=>r(t,e.nodes.todo_item)}inputRules({type:t}){return[z(/^\s*(\[ \])\s$/,t)]}}class Ce extends e{get name(){return"bold"}get schema(){return{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}],toDOM:()=>["strong",0]}}keys({type:t}){return{"Mod-b":H(t)}}commands({type:t}){return()=>H(t)}inputRules({type:t}){return[i(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,t)]}pasteRules({type:t}){return[c(/(?:\*\*|__)([^*_]+)(?:\*\*|__)/g,t)]}}class ve extends e{get name(){return"italic"}get schema(){return{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:()=>["em",0]}}keys({type:t}){return{"Mod-i":H(t)}}commands({type:t}){return()=>H(t)}inputRules({type:t}){return[i(/(?:^|[^_])(_([^_]+)_)$/,t),i(/(?:^|[^*])(\*([^*]+)\*)$/,t)]}pasteRules({type:t}){return[c(/_([^_]+)_/g,t),c(/\*([^*]+)\*/g,t)]}}class Ae extends e{get name(){return"link"}get defaultOptions(){return{openOnClick:!0,target:null}}get schema(){return{attrs:{href:{default:null},target:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:t=>({href:t.getAttribute("href"),target:t.getAttribute("target")})}],toDOM:t=>["a",{...t.attrs,rel:"noopener noreferrer nofollow",target:t.attrs.target||this.options.target},0]}}commands({type:t}){return e=>e.href?p(t,e):d(t)}pasteRules({type:t}){return[h(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z]{2,}\b([-a-zA-Z0-9@:%_+.~#?&//=,()!]*)/gi,t,(t=>({href:t})))]}get plugins(){return this.options.openOnClick?[new A({props:{handleClick:(t,e,n)=>{const{schema:o}=t.state,r=g(t.state,o.marks.link);r.href&&n.target instanceof HTMLAnchorElement&&(n.stopPropagation(),window.open(r.href,r.target))}}})]:[]}}class Me extends e{get name(){return"strike"}get schema(){return{parseDOM:[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",getAttrs:t=>"line-through"===t}],toDOM:()=>["s",0]}}keys({type:t}){return{"Mod-d":H(t)}}commands({type:t}){return()=>H(t)}inputRules({type:t}){return[i(/~([^~]+)~$/,t)]}pasteRules({type:t}){return[c(/~([^~]+)~/g,t)]}}class Se extends e{get name(){return"underline"}get schema(){return{parseDOM:[{tag:"u"},{style:"text-decoration",getAttrs:t=>"underline"===t}],toDOM:()=>["u",0]}}keys({type:t}){return{"Mod-u":H(t)}}commands({type:t}){return()=>H(t)}}class $e extends n{get name(){return"history"}get defaultOptions(){return{depth:"",newGroupDelay:""}}keys(){return{"Mod-z":_,"Mod-y":x,"Shift-Mod-z":x,"Mod-я":_,"Shift-Mod-я":x}}get plugins(){return[D({depth:this.options.depth,newGroupDelay:this.options.newGroupDelay})]}commands(){return{undo:()=>_,redo:()=>x,undoDepth:()=>O,redoDepth:()=>N}}}class ke extends n{get name(){return"placeholder"}get defaultOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",emptyNodeText:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0}}get plugins(){return[new A({props:{decorations:({doc:t,plugins:e,selection:n})=>{const o=e.find((t=>t.key.startsWith("editable$"))).props.editable()||!this.options.showOnlyWhenEditable,{anchor:r}=n,s=[],l=0===t.textContent.length;return!!o&&(t.descendants(((t,e)=>{const n=r>=e&&r<=e+t.nodeSize,o=0===t.content.size;if((n||!this.options.showOnlyCurrent)&&o){const n=[this.options.emptyNodeClass];l&&n.push(this.options.emptyEditorClass);const o=f.node(e,e+t.nodeSize,{class:n.join(" "),"data-empty-text":"function"==typeof this.options.emptyNodeText?this.options.emptyNodeText(t):this.options.emptyNodeText});s.push(o)}return!1})),u.create(t,s))}}})]}}class Re extends n{get name(){return"trailing_node"}get defaultOptions(){return{node:"paragraph",notAfter:["paragraph"]}}get plugins(){const t=new b(this.name),e=Object.entries(this.editor.schema.nodes).map((([,t])=>t)).filter((t=>this.options.notAfter.includes(t.name)));return[new A({key:t,view:()=>({update:e=>{const{state:n}=e;if(!t.getState(n))return;const{doc:o,schema:r,tr:s}=n,l=r.nodes[this.options.node],a=s.insert(o.content.size,l.create());e.dispatch(a)}}),state:{init:(t,n)=>{const o=n.tr.doc.lastChild;return!w({node:o,types:e})},apply:(t,n)=>{if(!t.docChanged)return n;const o=t.doc.lastChild;return!w({node:o,types:e})}}})]}}export{oe as B,se as C,ae as H,pe as I,de as L,he as O,ke as P,Me as S,be as T,Se as U,re as a,ye as b,fe as c,Ce as d,ve as e,Ae as f,ie as g,$e as h,le as i,Re as j,me as k,ge as l,we as m};
