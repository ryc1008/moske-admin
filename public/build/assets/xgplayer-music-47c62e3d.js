import{u as t,T as e,b as n,c as i,B as r,P as o}from"./xgplayer-ddb6d22b.js";function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,g(i.key),i)}}function l(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return(e=g(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=p(t);if(e){var r=p(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}(this,n)}}function g(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var m=function(){function t(e,n){c(this,t),this.url=e;var i=new window.XMLHttpRequest;i.target=this,i.responseType="arraybuffer",i.open("get",e),i.onload=function(){200!==i.status&&206!==i.status||n&&n instanceof Function&&n(i.response)},i.onerror=function(t){},this.xhr=i,this.run()}return l(t,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"run",value:function(){1===this.xhr.readyState&&this.xhr.send()}}]),t}(),x={ORDER:"order",SLOOP:"sloop",LOOP:"loop",RANDOM:"random"},k="xgplayer-music";function b(t,e,n){var i=Math.floor(Math.random()*(e-t)+t);return i===n?(i>e/2?e/=2:t=e/2,e-t>2?b(t,e,n):i):i}var O=function(o){h(u,r);var a=y(u);function u(){var t;c(this,u);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return f(v(t=a.call.apply(a,[this].concat(n))),"_onEnded",(function(){if("order"===t.mode&&t.index+1>=t.list.length)return t.player.pause(),void(t.player.currentTime=0);if(t.mode===x.SLOOP)t.change();else t.next()})),f(v(t),"_onDurationChange",(function(){var e=t.config.abCycle;t._initABCycle(e,t.player)})),f(v(t),"_onTimeUpdate",(function(){var e=v(t),n=e.config,i=e.player;if(!t.halfPass&&i.currentTime>i.duration/2&&t.confirmOrder(),n.abCycle){var r=n.abCycle,o=r.end>i.duration?i.duration:r.end;i.currentTime>=o?(r.loop||(i.pause(),t.emit("abCycle_ended")),i.currentTime=r.start||0):i.currentTime<r.start&&(i.currentTime=r.start||0)}})),t}return l(u,[{key:"afterCreate",value:function(){var r=this.player,o=this.playerConfig;t.addClass(r.root,k),this.halfPass=!1,this.list=this.config.list||[],this.nextIndex=-1,this.prevIndex=-1,this.history=[],this.disable=!(this.list.length>0),0!==this.list.length&&(!o.url&&this.list.length>0&&(o.url=this.list[0].src),o.poster||(o.poster=this.list[0].poster),o.title||(o.title=this.list[0].title||""),o.vid||(o.vid=this.list[0].vid||""),this._curInfo={src:o.url,poster:o.poster,title:o.title,vid:o.vid},this.index=0,this.on(e,this._onTimeUpdate),this.on(n,this._onEnded),this.on(i,this._onDurationChange),this.config.offline&&this.checkOffline(this._curInfo.src,this._curInfo.vid).then((function(t){0===t.code&&(o.url=t.url,r.state>=4&&(r.src=t.url))})).catch((function(t){})))}},{key:"destroy",value:function(){t.removeClass(this.player.root,k)}},{key:"_nextCompute",value:function(){if(!this.disable)switch(this.mode){case x.SLOOP:case x.ORDER:case x.LOOP:this.index+1<this.list.length?this.nextIndex=this.index+1:this.nextIndex=0;break;default:this.nextIndex=b(0,this.list.length,this.index)}}},{key:"_prevCompute",value:function(){if(!this.disable)switch(this.mode){case x.SLOOP:case x.ORDER:case x.LOOP:this.index-1>=0?this.prevIndex=this.index-1:this.prevIndex=this.list.length-1;break;default:this.prevIndex=b(0,this.list.length,this.index)}}},{key:"_emitChange",value:function(){this.emit("change",this._curInfo)}},{key:"_initABCycle",value:function(t,e){var n=e.plugins.progresspreview;if(t&&e){var i=t.end>this.player.duration?this.player.duration:t.end,r=t.start>this.player.duration?0:t.start,o={id:e.playerId,time:t.start,duration:i-r,text:t.text,color:t.color};n.findDot(o.id)?n.updateDot(o):n.createDot(o)}else n.findDot(e.playerId)&&n.deleteDot(e.playerId)}},{key:"random",value:function(){if(this.list.length<0)return null;var t=b(0,this.list.length,this.index);return this.list[t]}},{key:"next",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._nextCompute()),this.index=this.nextIndex,this.change())}},{key:"prev",value:function(){this.disable||(this.halfPass||(this.halfPass=!0,this._prevCompute()),this.index=this.prevIndex,this.change())}},{key:"forward",value:function(){var t=this.player,e=this.config.timeScale;t.currentTime=t.currentTime+e<t.duration?t.currentTime+e:t.duration-.1}},{key:"backward",value:function(){var t=this.player,e=this.config.timeScale;t.currentTime=t.currentTime-e>0?t.currentTime-e:0}},{key:"add",value:function(t){this.list.push({src:t.src,title:t.title,vid:t.vid,poster:t.poster})}},{key:"remove",value:function(t){var e=-1;this.list.every((function(n,i){return n.vid!==t||(e=i,!1)})),e>-1&&this.list.splice(e,1)}},{key:"setAbCycle",value:function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e&&"Object"===t.typeof(e)?this.config.abCycle=s({},e):this.config.abCycle=s({start:e||0,end:n||this.player.duration,loop:i},r),this._initABCycle(this.config.abCycle,this.player)}},{key:"removeAbCycle",value:function(){this.config.abCycle=null,this._initABCycle(null,this.player)}},{key:"updateList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.removeAbCycle(),this.player.pause(),this.player.currentTime=0,this.list=t,this.nextIndex=0,this.index=0,this.change()}},{key:"setIndex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;t<0||t>=this.list.length||(this.nextIndex=t,this.index=t,this.change())}},{key:"change",value:function(){var t=this;if(!this.disable){var e=this.player,n=this.list,i=this.index,r=n[i].vid;this.halfPass=!1,this.checkOffline(n[i].src,r).then((function(n){t._curInfo={title:t.list[t.index].title||"",vid:t.list[t.index].vid,poster:t.list[t.index].poster||"",src:n.url},e.playNext({url:n.url,vid:t.list[t.index].vid||0,poster:t.list[t.index].poster||"",autoplay:!0}),e.off("timeupdate",t._emitChange),e.once("timeupdate",t._emitChange),e.play()}))}}},{key:"checkOffline",value:function(t,e){var n=this;return new Promise((function(i,r){n.config.offline&&!n.disable||i({url:t,code:-1,vid:e});var o=n.player.database;o.openDB((function(){o.getDataByKey(o.myDB.ojstore.name,e,(function(n){setTimeout((function(){o.closeDB()}),5e3),i(n?{url:URL.createObjectURL(n.blob),code:0,vid:n.vid}:{url:t,code:-2,vid:e})}))}))}))}},{key:"confirmOrder",value:function(){this.halfPass=!0,this._nextCompute(),this._prevCompute(),this.config.preloadNext&&this.preload(this.nextIndex)}},{key:"preload",value:function(t){if(!(t<0||t>=this.list.length)){var e=this.list[t],n=this.player;this.checkOffline(e.src,e.vid).then((function(t){if(-2===t.code){var i=e.vid;new m(e.src,(function(t){n.database.openDB((function(){n.database.addData(n.database.myDB.ojstore.name,[{vid:i,blob:new Blob([t],{type:'audio/mp4; codecs="mp4a.40.5"'})}]),setTimeout((function(){n.database.closeDB()}),5e3)}))}))}}))}}},{key:"timeScale",get:function(){return this.config.timeScale||15},set:function(t){this.config.timeScale=t}},{key:"mode",get:function(){return this.config.mode||x.RANDOM},set:function(t){this.config.mode=t}}],[{key:"pluginName",get:function(){return"music"}},{key:"defaultConfig",get:function(){return{offline:!1,preloadNext:!0,abCycle:null,timeScale:15,mode:x.ORDER,list:[]}}},{key:"ModeType",get:function(){return Object.keys(x).map((function(t){return x[t]}))}}]),u}(),w=function(t){h(n,o);var e=y(n);function n(){return c(this,n),e.apply(this,arguments)}return l(n,[{key:"afterCreate",value:function(){var t=this;if(this.on("change",(function(e){if(e&&e.poster){if(t.find("img"))t.find("img").src=e.poster;else{var n=new Image;n.src=e.poster,t.appendChild(n)}t.find("img").src=e.poster,t.show()}else t.hide()})),this.playerConfig.poster){var e=new Image;e.src=this.playerConfig.poster,this.appendChild(e)}}},{key:"render",value:function(){return'<xg-icon class="xgplayer-cover"></xg-icon>'}}],[{key:"pluginName",get:function(){return"musiccover"}},{key:"defaultConfig",get:function(){return{index:6,position:o.POSITIONS.CONTROLS_LEFT}}}]),n}(),C=function(t){h(n,o);var e=y(n);function n(){var t;c(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return f(v(t=e.call.apply(e,[this].concat(r))),"onClick",(function(e){var n=v(t).player;e.preventDefault(),e.stopPropagation(),n.plugins.music.backward()})),t}return l(n,[{key:"afterCreate",value:function(){var t=this;this.initIcons();["click","touchstart"].forEach((function(e){t.bind(e,t.onClick)}))}},{key:"registerIcons",value:function(){return{musicBackward:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">\n      <path d="m 14,2.99996 0,10 -7,-5 7,-5 z m -7,5 0,5 -7,-5 7,-5 0,5 z m -7,0 0,0 z"></path>\n  </svg>',class:"xg-icon-mbackward"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.musicBackward)}},{key:"destroy",value:function(){var t=this;["click","touchstart"].forEach((function(e){t.unbind(e,t.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-backward">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicbackward"}},{key:"defaultConfig",get:function(){return{index:1,position:o.POSITIONS.CONTROLS_LEFT}}}]),n}(),P=function(t){h(n,o);var e=y(n);function n(){var t;c(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return f(v(t=e.call.apply(e,[this].concat(r))),"onClick",(function(e){var n=v(t).player;e.preventDefault(),e.stopPropagation(),n.plugins.music.prev()})),t}return l(n,[{key:"afterCreate",value:function(){var t=this;this.initIcons();["click","touchstart"].forEach((function(e){t.bind(e,t.onClick)}))}},{key:"registerIcons",value:function(){return{musicPrev:{icon:' <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="300 200 1024 1024">\n        <path d="M600 1140v-768h128v352l320-320v704l-320-320v352zz"></path>\n    </svg>',class:"xg-icon-mprev"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.musicPrev)}},{key:"destroy",value:function(){var t=this;["click","touchstart"].forEach((function(e){t.unbind(e,t.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-next">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicprev"}},{key:"defaultConfig",get:function(){return{index:2,position:o.POSITIONS.CONTROLS_LEFT}}}]),n}(),I=function(t){h(n,o);var e=y(n);function n(){var t;c(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return f(v(t=e.call.apply(e,[this].concat(r))),"onClick",(function(e){var n=v(t).player;e.preventDefault(),e.stopPropagation(),n.plugins.music.forward()})),t}return l(n,[{key:"afterCreate",value:function(){var t=this;this.initIcons();["click","touchstart"].forEach((function(e){t.bind(e,t.onClick)}))}},{key:"registerIcons",value:function(){return{musicForward:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="-2 0 21 15">\n        <path d="m 2,2.99996 0,10 7,-5 -7,-5 z m 7,5 0,5 7,-5 -7,-5 0,5 z m 7,0 0,0 z"></path>\n      </svg>',class:"xg-icon-mforward"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.musicForward)}},{key:"destroy",value:function(){var t=this;["click","touchstart"].forEach((function(e){t.unbind(e,t.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-forward">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicforward"}},{key:"defaultConfig",get:function(){return{index:5,position:o.POSITIONS.CONTROLS_LEFT}}}]),n}(),T=function(t){h(n,o);var e=y(n);function n(){var t;c(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return f(v(t=e.call.apply(e,[this].concat(r))),"onClick",(function(e){var n=v(t).player;e.preventDefault(),e.stopPropagation(),n.plugins.music.next()})),t}return l(n,[{key:"afterCreate",value:function(){var t=this;this.initIcons();["click","touchstart"].forEach((function(e){t.bind(e,t.onClick)}))}},{key:"registerIcons",value:function(){return{musicNext:{icon:' <svg xmlns="http://www.w3.org/2000/svg" width="40" height="32" viewBox="100 200 1024 1024">\n        <path d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z">\n      </svg>',class:"xg-icon-mnext"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.musicNext)}},{key:"destroy",value:function(){var t=this;["click","touchstart"].forEach((function(e){t.unbind(e,t.onClick)}))}},{key:"render",value:function(){return'<xg-icon class="xgplayer-next">\n            <div class="xgplayer-icon">\n            </div>\n          </xg-icon>'}}],[{key:"pluginName",get:function(){return"musicnext"}},{key:"defaultConfig",get:function(){return{index:4,position:o.POSITIONS.CONTROLS_LEFT}}}]),n}(),_=function(t){h(n,o);var e=y(n);function n(){return c(this,n),e.apply(this,arguments)}return l(n,[{key:"beforeCreate",value:function(t){var e=t.player.plugins.progress;e&&(t.root=e.root)}},{key:"afterCreate",value:function(){var t=this;this.on("change",(function(e){e&&e.title?t.root.innerHTML="".concat(e.title):t.root.innerHTML=""}))}},{key:"render",value:function(){var t=this.playerConfig;return'<xg-title class="xgplayer-name">\n          '.concat(t.title||"","\n       </xg-title>")}}],[{key:"pluginName",get:function(){return"musicmeta"}},{key:"defaultConfig",get:function(){return{index:0}}}]),n}();var S=l((function e(n,i){c(this,e),console.log("config",n,i),console.log("playerConfig","Object"!==t.typeOf(i.controls)),function(e){if("Object"!==t.typeOf(e.controls))e.controls={mode:"flex",initShow:!0};else{var n=e.controls;e.controls=s({mode:"flex",initShow:!0},n)}var i=e.play||{};e.play=s({index:3},i),e.marginControls=!0,e.mediaType="audio"}(i),this.plugins=[O,C,P,I,T,w,_],this.ignores=["start","cssFullScreen","fullscreen","pip","enter","replay","pc","loading","poster"]}));export{S as M};
