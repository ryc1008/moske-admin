import{c as e,R as t,l as n,a as r,f as o}from"./prosemirror-transform-0ba15ba3.js";import{F as l,S as d,a as i}from"./prosemirror-model-e99bf1dc.js";import{S as p}from"./prosemirror-state-aff6b6a5.js";function s(n,r=null){return function(p,s){let{$from:c,$to:a}=p.selection,f=c.blockRange(a),u=!1,m=f;if(!f)return!1;if(f.depth>=2&&c.node(f.depth-1).type.compatibleContent(n)&&0==f.startIndex){if(0==c.index(f.depth-1))return!1;let e=p.doc.resolve(f.start-2);m=new i(e,e,f.depth),f.endIndex<f.parent.childCount&&(f=new i(c,p.doc.resolve(a.end(f.depth)),f.depth)),u=!0}let h=o(m,n,r,f);return!!h&&(s&&s(function(n,r,o,i,p){let s=l.empty;for(let e=o.length-1;e>=0;e--)s=l.from(o[e].type.create(o[e].attrs,s));n.step(new t(r.start-(i?2:0),r.end,r.start,r.end,new d(s,0,0),o.length,!0));let c=0;for(let e=0;e<o.length;e++)o[e].type==p&&(c=e+1);let a=o.length-c,f=r.start+o.length-(i?2:0),u=r.parent;for(let t=r.startIndex,l=r.endIndex,d=!0;t<l;t++,d=!1)!d&&e(n.doc,f,a)&&(n.split(f,a),f+=2*a),f+=u.child(t).nodeSize;return n}(p.tr,f,h,u,n).scrollIntoView()),!0)}}function c(t,n){return function(r,o){let{$from:i,$to:s,node:c}=r.selection;if(c&&c.isBlock||i.depth<2||!i.sameParent(s))return!1;let a=i.node(-1);if(a.type!=t)return!1;if(0==i.parent.content.size&&i.node(-1).childCount==i.indexAfter(-1)){if(3==i.depth||i.node(-3).type!=t||i.index(-2)!=i.node(-2).childCount-1)return!1;if(o){let e=l.empty,n=i.index(-1)?1:i.index(-2)?2:3;for(let t=i.depth-n;t>=i.depth-3;t--)e=l.from(i.node(t).copy(e));let s=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3;e=e.append(l.from(t.createAndFill()));let c=i.before(i.depth-(n-1)),a=r.tr.replace(c,i.after(-s),new d(e,4-n,0)),f=-1;a.doc.nodesBetween(c,a.doc.content.size,((e,t)=>{if(f>-1)return!1;e.isTextblock&&0==e.content.size&&(f=t+1)})),f>-1&&a.setSelection(p.near(a.doc.resolve(f))),o(a.scrollIntoView())}return!0}let f=s.pos==i.end()?a.contentMatchAt(0).defaultType:null,u=r.tr.delete(i.pos,s.pos),m=f?[n?{type:t,attrs:n}:null,{type:f}]:void 0;return!!e(u.doc,i.pos,2,m)&&(o&&o(u.split(i.pos,2,m).scrollIntoView()),!0)}}function a(e){return function(o,p){let{$from:s,$to:c}=o.selection,a=s.blockRange(c,(t=>t.childCount>0&&t.firstChild.type==e));return!!a&&(!p||(s.node(a.depth-1).type==e?function(e,o,p,s){let c=e.tr,a=s.end,f=s.$to.end(s.depth);a<f&&(c.step(new t(a-1,f,a,f,new d(l.from(p.create(null,s.parent.copy())),1,0),1,!0)),s=new i(c.doc.resolve(s.$from.pos),c.doc.resolve(f),s.depth));const u=n(s);if(null==u)return!1;c.lift(s,u);let m=c.mapping.map(a,-1)-1;r(c.doc,m)&&c.join(m);return o(c.scrollIntoView()),!0}(o,p,e,a):function(e,n,r){let o=e.tr,i=r.parent;for(let t=r.end,l=r.endIndex-1,d=r.startIndex;l>d;l--)t-=i.child(l).nodeSize,o.delete(t-1,t+1);let p=o.doc.resolve(r.start),s=p.nodeAfter;if(o.mapping.map(r.end)!=r.start+p.nodeAfter.nodeSize)return!1;let c=0==r.startIndex,a=r.endIndex==i.childCount,f=p.node(-1),u=p.index(-1);if(!f.canReplace(u+(c?0:1),u+1,s.content.append(a?l.empty:l.from(i))))return!1;let m=p.pos,h=m+s.nodeSize;return o.step(new t(m-(c?1:0),h+(a?1:0),m+1,h-1,new d((c?l.empty:l.from(i.copy(l.empty))).append(a?l.empty:l.from(i.copy(l.empty))),c?0:1,a?0:1),c?0:1)),n(o.scrollIntoView()),!0}(o,p,a)))}}function f(e){return function(n,r){let{$from:o,$to:i}=n.selection,p=o.blockRange(i,(t=>t.childCount>0&&t.firstChild.type==e));if(!p)return!1;let s=p.startIndex;if(0==s)return!1;let c=p.parent,a=c.child(s-1);if(a.type!=e)return!1;if(r){let o=a.lastChild&&a.lastChild.type==c.type,i=l.from(o?e.create():null),s=new d(l.from(e.create(null,l.from(c.type.create(null,i)))),o?3:1,0),f=p.start,u=p.end;r(n.tr.step(new t(f-(o?3:1),u,f,u,s,1,!0)).scrollIntoView())}return!0}}export{f as a,a as l,c as s,s as w};
