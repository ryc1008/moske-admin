import{P as e}from"./prosemirror-state-aff6b6a5.js";import{f as t,a as n}from"./prosemirror-transform-0ba15ba3.js";class r{constructor(e,t){var n;this.match=e,this.match=e,this.handler="string"==typeof t?(n=t,function(e,t,r,s){let o=n;if(t[1]){let e=t[0].lastIndexOf(t[1]);o+=t[0].slice(e+t[1].length);let n=(r+=e)-s;n>0&&(o=t[0].slice(e-n,e)+o,r=s)}return e.tr.insertText(o,r,s)}):t}}const s=500;function o({rules:t}){let n=new e({state:{init:()=>null,apply(e,t){let n=e.getMeta(this);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput:(e,r,s,o)=>l(e,r,s,o,t,n),handleDOMEvents:{compositionend:e=>{setTimeout((()=>{let{$cursor:r}=e.state.selection;r&&l(e,r.pos,r.pos,"",t,n)}))}}},isInputRules:!0});return n}function l(e,t,n,r,o,l){if(e.composing)return!1;let i=e.state,a=i.doc.resolve(t);if(a.parent.type.spec.code)return!1;let c=a.parent.textBetween(Math.max(0,a.parentOffset-s),a.parentOffset,null,"ï¿¼")+r;for(let s=0;s<o.length;s++){let a=o[s].match.exec(c),u=a&&o[s].handler(i,a,t-(a[0].length-r.length),n);if(u)return e.dispatch(u.setMeta(l,{transform:u,from:t,to:n,text:r})),!0}return!1}const i=(e,t)=>{let n=e.plugins;for(let r=0;r<n.length;r++){let s,o=n[r];if(o.spec.isInputRules&&(s=o.getState(e))){if(t){let n=e.tr,r=s.transform;for(let e=r.steps.length-1;e>=0;e--)n.step(r.steps[e].invert(r.docs[e]));if(s.text){let t=n.doc.resolve(s.from).marks();n.replaceWith(s.from,s.to,e.schema.text(s.text,t))}else n.delete(s.from,s.to);t(n)}return!0}}return!1};function a(e,s,o=null,l){return new r(e,((e,r,i,a)=>{let c=o instanceof Function?o(r):o,u=e.tr.delete(i,a),f=u.doc.resolve(i).blockRange(),p=f&&t(f,s,c);if(!p)return null;u.wrap(f,p);let d=u.doc.resolve(i-1).nodeBefore;return d&&d.type==s&&n(u.doc,i-1)&&(!l||l(r,d))&&u.join(i-1),u}))}function c(e,t,n=null){return new r(e,((e,r,s,o)=>{let l=e.doc.resolve(s),i=n instanceof Function?n(r):n;return l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),t)?e.tr.delete(s,o).setBlockType(s,s,t,i):null}))}export{r as I,o as i,c as t,i as u,a as w};
